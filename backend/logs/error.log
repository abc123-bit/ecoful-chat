2025-09-16 15:30:55 | ERROR    | app.api.v1.endpoints.knowledge_bases:list_knowledge_bases:47 - Error listing knowledge bases: password authentication failed for user "postgres"
2025-09-16 15:30:55 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to list knowledge bases
2025-09-16 15:43:16 | ERROR    | app.api.v1.endpoints.knowledge_bases:list_knowledge_bases:47 - Error listing knowledge bases: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "knowledge_bases" does not exist
[SQL: SELECT knowledge_bases.id, knowledge_bases.name, knowledge_bases.description, knowledge_bases.collection_name, knowledge_bases.embedding_model, knowledge_bases.chunk_size, knowledge_bases.chunk_overlap, knowledge_bases.retrieval_config, knowledge_bases.status, knowledge_bases.created_at, knowledge_bases.updated_at, knowledge_bases.file_count, knowledge_bases.document_count 
FROM knowledge_bases 
WHERE knowledge_bases.status = $1::VARCHAR ORDER BY knowledge_bases.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER]
[parameters: ('active', 100, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-16 15:43:16 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to list knowledge bases
2025-09-16 15:44:02 | ERROR    | app.api.v1.endpoints.knowledge_bases:list_knowledge_bases:47 - Error listing knowledge bases: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "knowledge_bases" does not exist
[SQL: SELECT knowledge_bases.id, knowledge_bases.name, knowledge_bases.description, knowledge_bases.collection_name, knowledge_bases.embedding_model, knowledge_bases.chunk_size, knowledge_bases.chunk_overlap, knowledge_bases.retrieval_config, knowledge_bases.status, knowledge_bases.created_at, knowledge_bases.updated_at, knowledge_bases.file_count, knowledge_bases.document_count 
FROM knowledge_bases 
WHERE knowledge_bases.status = $1::VARCHAR ORDER BY knowledge_bases.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER]
[parameters: ('active', 100, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-16 15:44:02 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to list knowledge bases
2025-09-16 15:49:46 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-16 15:50:27 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:332 - Error uploading file to knowledge base 1: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-16 15:50:27 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-16 15:52:33 | ERROR    | app.services.vector_store:delete_collection:140 - Failed to delete collection kb_775d55ce: Collection [kb_775d55ce] does not exists
2025-09-16 15:52:33 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:177 - Error deleting knowledge base 1: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-16 15:52:33 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-16 15:55:22 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:332 - Error uploading file to knowledge base 2: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-16 15:55:22 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-16 16:21:43 | ERROR    | app.services.vector_store:delete_collection:140 - Failed to delete collection kb_13199450: Collection [kb_13199450] does not exists
2025-09-16 16:21:43 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:180 - Error deleting knowledge base 2: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-16 16:21:43 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-16 16:32:58 | ERROR    | app.services.vector_store:delete_collection:140 - Failed to delete collection kb_b5c834fa: Collection [kb_b5c834fa] does not exists
2025-09-16 16:32:58 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:184 - Error deleting knowledge base 3: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-16 16:32:58 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-16 16:33:14 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:369 - Error uploading file to knowledge base 4: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-16 16:33:14 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-16 16:38:16 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:340 - Error uploading file to knowledge base 4: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-16 16:38:16 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-16 16:39:52 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:340 - Error uploading file to knowledge base 6: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-16 16:39:52 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-16 16:40:30 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:340 - Error uploading file to knowledge base 5: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-16 16:40:30 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-16 17:11:10 | ERROR    | app.services.vector_store:delete_collection:140 - Failed to delete collection kb_b5447d3f: Collection [kb_b5447d3f] does not exists
2025-09-16 17:11:10 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:183 - Error deleting knowledge base 4: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-16 17:11:10 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-16 17:11:30 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:336 - Error uploading file to knowledge base 6: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-16 17:11:30 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-16 17:12:45 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:336 - Error uploading file to knowledge base 6: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-16 17:12:45 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-16 17:12:50 | ERROR    | app.services.vector_store:delete_collection:140 - Failed to delete collection kb_2931598d: Collection [kb_2931598d] does not exists
2025-09-16 17:12:50 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:183 - Error deleting knowledge base 5: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-16 17:12:50 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-16 17:32:02 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:334 - Error uploading file to knowledge base 7: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-16 17:32:02 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-16 17:32:24 | ERROR    | app.services.vector_store:delete_collection:140 - Failed to delete collection kb_9dc44801: Collection [kb_9dc44801] does not exists
2025-09-16 17:32:24 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:180 - Error deleting knowledge base 6: object bool can't be used in 'await' expression
2025-09-16 17:32:24 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-16 17:32:46 | ERROR    | app.services.vector_store:delete_collection:140 - Failed to delete collection kb_9dc44801: Collection [kb_9dc44801] does not exists
2025-09-16 17:32:46 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:180 - Error deleting knowledge base 6: object bool can't be used in 'await' expression
2025-09-16 17:32:46 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-16 17:32:50 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:334 - Error uploading file to knowledge base 6: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-16 17:32:50 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-17 08:46:20 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:334 - Error uploading file to knowledge base 7: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 08:46:20 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-17 09:01:55 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:377 - Error uploading file to knowledge base 7: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 09:01:55 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-17 09:03:21 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:377 - Error uploading file to knowledge base 8: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 09:03:21 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-17 09:13:23 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:391 - Error uploading file to knowledge base 14: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 09:13:23 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-17 09:14:34 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:402 - Error uploading file to knowledge base 15: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 09:14:34 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-17 09:15:19 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:402 - Error uploading file to knowledge base 16: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 09:15:19 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-17 09:16:35 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:402 - Error uploading file to knowledge base 17: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 09:16:35 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-17 09:17:47 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:402 - Error uploading file to knowledge base 18: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 09:17:47 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-17 09:22:31 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:399 - Error uploading file to knowledge base 8: MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 09:22:31 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-17 09:25:59 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:402 - Error uploading file to knowledge base 19: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 09:25:59 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-17 09:28:38 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-17 09:28:47 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-17 09:28:52 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-17 09:29:13 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:399 - Error uploading file to knowledge base 8: MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 09:29:13 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-17 09:29:31 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-17 09:32:15 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:399 - Error uploading file to knowledge base 8: MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 09:32:15 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to upload file
2025-09-17 09:42:19 | ERROR    | app.api.v1.endpoints.knowledge_bases:upload_file:393 - 上传出现错误： 8: MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 09:42:19 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - 文件上传失败
2025-09-17 09:47:17 | ERROR    | app.services.file_processor:process_file:384 - Error processing file Chatflow工作总结.docx: seek
2025-09-17 09:47:17 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:298 - Error processing file 29: seek
2025-09-17 09:48:09 | ERROR    | app.services.file_processor:process_file:384 - Error processing file 环评名录查询使用教程.docx: seek
2025-09-17 09:48:09 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:298 - Error processing file 30: seek
2025-09-17 09:55:41 | ERROR    | app.services.file_processor:process_file:384 - Error processing file 排污许可证申请表 (玻璃制造）.docx: bad character range e-\\ at position 26
2025-09-17 09:55:41 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:304 - Error processing file 31: bad character range e-\\ at position 26
2025-09-17 10:00:20 | ERROR    | app.services.file_processor:process_file:384 - Error processing file cesi.docx: bad character range e-\\ at position 26
2025-09-17 10:00:20 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:304 - Error processing file 32: bad character range e-\\ at position 26
2025-09-17 10:02:15 | ERROR    | app.services.file_processor:process_file:384 - Error processing file cesi.pdf: bad character range e-\\ at position 26
2025-09-17 10:02:15 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:304 - Error processing file 33: bad character range e-\\ at position 26
2025-09-17 10:02:57 | ERROR    | app.services.file_processor:process_file:384 - Error processing file 测试.txt: bad character range e-\\ at position 26
2025-09-17 10:02:57 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:304 - Error processing file 35: bad character range e-\\ at position 26
2025-09-17 10:03:11 | ERROR    | app.services.file_processor:process_file:384 - Error processing file 测试.txt: bad character range e-\\ at position 26
2025-09-17 10:03:11 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:304 - Error processing file 36: bad character range e-\\ at position 26
2025-09-17 10:18:46 | ERROR    | app.services.vector_store:get_or_create_collection:121 - Failed to get or create collection kb_f44201d5: Validation error: metadata: Metadata cannot be empty
2025-09-17 10:18:46 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:304 - Error processing file 38: Validation error: metadata: Metadata cannot be empty
2025-09-17 10:19:42 | ERROR    | app.services.vector_store:get_or_create_collection:121 - Failed to get or create collection kb_f44201d5: Validation error: metadata: Metadata cannot be empty
2025-09-17 10:19:42 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:304 - Error processing file 39: Validation error: metadata: Metadata cannot be empty
2025-09-17 10:32:23 | ERROR    | app.services.vector_store:get_or_create_collection:121 - Failed to get or create collection kb_8a658a78: Validation error: metadata: Metadata cannot be empty
2025-09-17 10:32:23 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:304 - Error processing file 40: Validation error: metadata: Metadata cannot be empty
2025-09-17 10:32:38 | ERROR    | app.services.vector_store:get_or_create_collection:121 - Failed to get or create collection kb_f44201d5: Validation error: metadata: Metadata cannot be empty
2025-09-17 10:32:38 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:304 - Error processing file 41: Validation error: metadata: Metadata cannot be empty
2025-09-17 10:48:23 | ERROR    | app.services.vector_store:get_or_create_collection:121 - Failed to get or create collection kb_f44201d5: Validation error: metadata: Metadata cannot be empty
2025-09-17 10:48:23 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:324 - Error processing file 42: Validation error: metadata: Metadata cannot be empty
2025-09-17 10:48:49 | ERROR    | app.services.vector_store:get_or_create_collection:121 - Failed to get or create collection kb_8cb894f8: Validation error: metadata: Metadata cannot be empty
2025-09-17 10:48:49 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:324 - Error processing file 44: Validation error: metadata: Metadata cannot be empty
2025-09-17 10:48:53 | ERROR    | app.services.vector_store:get_or_create_collection:121 - Failed to get or create collection kb_8cb894f8: Validation error: metadata: Metadata cannot be empty
2025-09-17 10:48:53 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:324 - Error processing file 45: Validation error: metadata: Metadata cannot be empty
2025-09-17 10:50:54 | ERROR    | app.services.vector_store:get_or_create_collection:121 - Failed to get or create collection kb_8cb894f8: Validation error: metadata: Metadata cannot be empty
2025-09-17 10:50:54 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:324 - Error processing file 46: Validation error: metadata: Metadata cannot be empty
2025-09-17 11:05:24 | ERROR    | app.services.vector_store:get_or_create_collection:121 - Failed to get or create collection kb_f44201d5: Validation error: metadata: Metadata cannot be empty
2025-09-17 11:05:24 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:304 - Error processing file 47: Validation error: metadata: Metadata cannot be empty
2025-09-17 11:07:39 | ERROR    | app.services.vector_store:delete_collection:140 - Failed to delete collection kb_f44201d5: Collection [kb_f44201d5] does not exists
2025-09-17 11:07:39 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:181 - Error deleting knowledge base 8: object bool can't be used in 'await' expression
2025-09-17 11:07:39 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 11:22:47 | ERROR    | app.services.vector_store:get_or_create_collection:121 - Failed to get or create collection kb_8cb894f8: Validation error: metadata: Metadata cannot be empty
2025-09-17 11:22:47 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:304 - Error processing file 48: Validation error: metadata: Metadata cannot be empty
2025-09-17 11:31:43 | ERROR    | app.services.vector_store:get_or_create_collection:121 - Failed to get or create collection kb_f44201d5: Validation error: metadata: Metadata cannot be empty
2025-09-17 11:31:43 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 49: Validation error: metadata: Metadata cannot be empty
2025-09-17 11:45:16 | ERROR    | app.services.bailian_client:create_embeddings:80 - HTTP error creating embeddings: 404 - 
2025-09-17 11:45:20 | ERROR    | app.services.bailian_client:create_embeddings:80 - HTTP error creating embeddings: 404 - 
2025-09-17 11:45:25 | ERROR    | app.services.bailian_client:create_embeddings:80 - HTTP error creating embeddings: 404 - 
2025-09-17 11:45:25 | ERROR    | app.services.vector_store:add_documents:223 - Failed to add documents to collection kb_f44201d5: RetryError[<Future at 0x247ef72f9d0 state=finished raised HTTPStatusError>]
2025-09-17 11:45:25 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 50: RetryError[<Future at 0x247ef72f9d0 state=finished raised HTTPStatusError>]
2025-09-17 14:21:59 | ERROR    | app.services.bailian_client:create_embeddings:80 - HTTP error creating embeddings: 404 - 
2025-09-17 14:22:03 | ERROR    | app.services.bailian_client:create_embeddings:80 - HTTP error creating embeddings: 404 - 
2025-09-17 14:22:08 | ERROR    | app.services.bailian_client:create_embeddings:80 - HTTP error creating embeddings: 404 - 
2025-09-17 14:22:08 | ERROR    | app.services.vector_store:add_documents:223 - Failed to add documents to collection kb_f44201d5: RetryError[<Future at 0x197970fb730 state=finished raised HTTPStatusError>]
2025-09-17 14:22:08 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 51: RetryError[<Future at 0x197970fb730 state=finished raised HTTPStatusError>]
2025-09-17 14:23:03 | ERROR    | app.services.vector_store:delete_collection:157 - Failed to delete collection kb_015f09fc: Collection [kb_015f09fc] does not exists
2025-09-17 14:23:03 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:181 - Error deleting knowledge base 9: object bool can't be used in 'await' expression
2025-09-17 14:23:03 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 14:33:28 | ERROR    | app.services.bailian_client:create_embeddings:80 - HTTP error creating embeddings: 404 - 
2025-09-17 14:33:32 | ERROR    | app.services.bailian_client:create_embeddings:80 - HTTP error creating embeddings: 404 - 
2025-09-17 14:33:37 | ERROR    | app.services.bailian_client:create_embeddings:80 - HTTP error creating embeddings: 404 - 
2025-09-17 14:33:37 | ERROR    | app.services.vector_store:add_documents:223 - Failed to add documents to collection kb_f44201d5: RetryError[<Future at 0x1d87a2bd750 state=finished raised HTTPStatusError>]
2025-09-17 14:33:37 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 53: RetryError[<Future at 0x1d87a2bd750 state=finished raised HTTPStatusError>]
2025-09-17 14:42:14 | ERROR    | app.services.bailian_client:create_embeddings:80 - HTTP error creating embeddings: 404 - 
2025-09-17 14:42:19 | ERROR    | app.services.bailian_client:create_embeddings:80 - HTTP error creating embeddings: 404 - 
2025-09-17 14:42:24 | ERROR    | app.services.bailian_client:create_embeddings:80 - HTTP error creating embeddings: 404 - 
2025-09-17 14:42:24 | ERROR    | app.services.vector_store:add_documents:223 - Failed to add documents to collection kb_f44201d5: RetryError[<Future at 0x1cec8beda50 state=finished raised HTTPStatusError>]
2025-09-17 14:42:24 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 54: RetryError[<Future at 0x1cec8beda50 state=finished raised HTTPStatusError>]
2025-09-17 15:02:38 | ERROR    | app.services.bailian_client:create_embeddings:100 - HTTP error creating embeddings: 404 - 
2025-09-17 15:02:38 | ERROR    | app.services.bailian_client:create_embeddings:103 - API endpoint not found: https://dashscope.aliyuncs.com/api/v1/embeddings
2025-09-17 15:02:38 | ERROR    | app.services.bailian_client:create_embeddings:104 - Please check if the endpoint URL is correct
2025-09-17 15:02:43 | ERROR    | app.services.bailian_client:create_embeddings:100 - HTTP error creating embeddings: 404 - 
2025-09-17 15:02:43 | ERROR    | app.services.bailian_client:create_embeddings:103 - API endpoint not found: https://dashscope.aliyuncs.com/api/v1/embeddings
2025-09-17 15:02:43 | ERROR    | app.services.bailian_client:create_embeddings:104 - Please check if the endpoint URL is correct
2025-09-17 15:02:47 | ERROR    | app.services.bailian_client:create_embeddings:100 - HTTP error creating embeddings: 404 - 
2025-09-17 15:02:47 | ERROR    | app.services.bailian_client:create_embeddings:103 - API endpoint not found: https://dashscope.aliyuncs.com/api/v1/embeddings
2025-09-17 15:02:47 | ERROR    | app.services.bailian_client:create_embeddings:104 - Please check if the endpoint URL is correct
2025-09-17 15:02:47 | ERROR    | app.services.vector_store:add_documents:223 - Failed to add documents to collection kb_8cb894f8: RetryError[<Future at 0x24e8e7a9d20 state=finished raised HTTPStatusError>]
2025-09-17 15:02:47 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 55: RetryError[<Future at 0x24e8e7a9d20 state=finished raised HTTPStatusError>]
2025-09-17 15:16:47 | ERROR    | app.services.vector_store:add_documents:223 - Failed to add documents to collection kb_8cb894f8: Expected metadata value to be a str, int, float, bool, SparseVector, or None, got [] which is a list in add.
2025-09-17 15:16:47 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 56: Expected metadata value to be a str, int, float, bool, SparseVector, or None, got [] which is a list in add.
2025-09-17 15:17:25 | ERROR    | app.services.vector_store:add_documents:223 - Failed to add documents to collection kb_8cb894f8: Expected metadata value to be a str, int, float, bool, SparseVector, or None, got [] which is a list in add.
2025-09-17 15:17:25 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 58: Expected metadata value to be a str, int, float, bool, SparseVector, or None, got [] which is a list in add.
2025-09-17 15:30:50 | ERROR    | app.services.vector_store:add_documents:272 - Failed to add documents to collection kb_f44201d5: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 15:30:50 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 59: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 15:32:28 | ERROR    | app.services.vector_store:add_documents:272 - Failed to add documents to collection kb_f44201d5: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 15:32:28 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 60: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 15:34:17 | ERROR    | app.services.vector_store:add_documents:312 - Failed to add documents to collection kb_f44201d5: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 15:34:17 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 62: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 15:42:25 | ERROR    | app.services.vector_store:delete_collection:233 - Failed to delete collection kb_015f09fc: Collection [kb_015f09fc] does not exists
2025-09-17 15:42:25 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:181 - Error deleting knowledge base 9: object bool can't be used in 'await' expression
2025-09-17 15:42:25 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 16:22:28 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-17 16:24:58 | ERROR    | app.services.vector_store:add_documents:312 - Failed to add documents to collection kb_f44201d5: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 16:24:58 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 64: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 16:27:56 | ERROR    | app.services.vector_store:add_documents:312 - Failed to add documents to collection kb_f44201d5: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 16:27:56 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 66: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 16:28:25 | ERROR    | app.services.vector_store:add_documents:312 - Failed to add documents to collection kb_f44201d5: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 16:28:25 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 69: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 16:28:26 | ERROR    | app.services.vector_store:add_documents:312 - Failed to add documents to collection kb_f44201d5: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 16:28:26 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 70: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 16:39:40 | ERROR    | app.services.vector_store:create_collection:160 - Failed to create collection kb_20: Failed to deserialize the JSON body into the target type: metadata.description: data did not match any variant of untagged enum MetadataValue at line 1 column 82
2025-09-17 16:39:40 | ERROR    | app.api.v1.endpoints.knowledge_bases:create_knowledge_base:90 - Error creating knowledge base: Failed to deserialize the JSON body into the target type: metadata.description: data did not match any variant of untagged enum MetadataValue at line 1 column 82
2025-09-17 16:39:40 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to create knowledge base
2025-09-17 16:40:02 | ERROR    | app.services.vector_store:add_documents:312 - Failed to add documents to collection kb_f44201d5: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 16:40:02 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 71: Failed to deserialize the JSON body into the target type: metadatas[0].chunk_id: data did not match any variant of untagged enum MetadataValue at line 1 column 5559
2025-09-17 16:44:40 | ERROR    | app.services.vector_store:delete_collection:233 - Failed to delete collection kb_96dc2ba8: Collection [kb_96dc2ba8] does not exists
2025-09-17 16:44:40 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:181 - Error deleting knowledge base 20: object bool can't be used in 'await' expression
2025-09-17 16:44:40 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 16:44:45 | ERROR    | app.services.vector_store:delete_collection:233 - Failed to delete collection kb_96dc2ba8: Collection [kb_96dc2ba8] does not exists
2025-09-17 16:44:45 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:181 - Error deleting knowledge base 20: object bool can't be used in 'await' expression
2025-09-17 16:44:45 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 16:44:58 | ERROR    | app.services.vector_store:create_collection:160 - Failed to create collection kb_21: Failed to deserialize the JSON body into the target type: metadata.description: data did not match any variant of untagged enum MetadataValue at line 1 column 82
2025-09-17 16:44:58 | ERROR    | app.api.v1.endpoints.knowledge_bases:create_knowledge_base:90 - Error creating knowledge base: Failed to deserialize the JSON body into the target type: metadata.description: data did not match any variant of untagged enum MetadataValue at line 1 column 82
2025-09-17 16:44:58 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to create knowledge base
2025-09-17 16:45:10 | ERROR    | app.services.vector_store:delete_collection:233 - Failed to delete collection kb_338fe394: Collection [kb_338fe394] does not exists
2025-09-17 16:45:10 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:181 - Error deleting knowledge base 21: object bool can't be used in 'await' expression
2025-09-17 16:45:10 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 16:48:53 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 72: 'ChromaVectorStore' object has no attribute 'get_or_create_collection'
2025-09-17 16:49:13 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 73: 'ChromaVectorStore' object has no attribute 'get_or_create_collection'
2025-09-17 17:11:51 | ERROR    | app.api.v1.endpoints.knowledge_bases:create_knowledge_base:90 - Error creating knowledge base: 'VectorStoreManager' object has no attribute 'create_knowledge_base_collection'
2025-09-17 17:11:51 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to create knowledge base
2025-09-17 17:11:58 | ERROR    | app.api.v1.endpoints.knowledge_bases:create_knowledge_base:90 - Error creating knowledge base: 'VectorStoreManager' object has no attribute 'create_knowledge_base_collection'
2025-09-17 17:11:58 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to create knowledge base
2025-09-17 17:12:15 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:315 - Error processing file 74: 'ChromaVectorStore' object has no attribute 'get_or_create_collection'
2025-09-17 17:12:19 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:181 - Error deleting knowledge base 22: 'VectorStoreManager' object has no attribute 'delete_knowledge_base_collection'
2025-09-17 17:12:19 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 17:33:02 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:182 - Error deleting knowledge base 23: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 17:33:02 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 17:33:09 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:182 - Error deleting knowledge base 22: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 17:33:09 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 17:33:13 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:182 - Error deleting knowledge base 21: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 17:33:13 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 17:33:19 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:182 - Error deleting knowledge base 20: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 17:33:19 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 17:33:23 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:182 - Error deleting knowledge base 19: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 17:33:23 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 17:33:28 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:182 - Error deleting knowledge base 18: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 17:33:28 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 17:35:36 | ERROR    | app.services.bailian_client:create_embeddings:100 - HTTP error creating embeddings: 400 - {"error":{"code":"InvalidParameter","param":null,"message":"<400> InternalError.Algo.InvalidParameter: Value error, batch size is invalid, it should not be larger than 10.: input.contents","type":"InvalidParameter"},"id":"98a7d2ab-3ebf-4fed-98dd-97e02487a4c0","request_id":"98a7d2ab-3ebf-4fed-98dd-97e02487a4c0"}
2025-09-17 17:35:42 | ERROR    | app.services.bailian_client:create_embeddings:100 - HTTP error creating embeddings: 400 - {"error":{"code":"InvalidParameter","param":null,"message":"<400> InternalError.Algo.InvalidParameter: Value error, batch size is invalid, it should not be larger than 10.: input.contents","type":"InvalidParameter"},"id":"8c20fb0f-6f2e-4d23-b9ad-cc50b1725e29","request_id":"8c20fb0f-6f2e-4d23-b9ad-cc50b1725e29"}
2025-09-17 17:35:47 | ERROR    | app.services.bailian_client:create_embeddings:100 - HTTP error creating embeddings: 400 - {"error":{"code":"InvalidParameter","param":null,"message":"<400> InternalError.Algo.InvalidParameter: Value error, batch size is invalid, it should not be larger than 10.: input.contents","type":"InvalidParameter"},"id":"a16f5948-d323-482d-8d34-f88b261ca56f","request_id":"a16f5948-d323-482d-8d34-f88b261ca56f"}
2025-09-17 17:35:47 | ERROR    | app.services.vector_store:add_documents:231 - Failed to generate embeddings for batch: RetryError[<Future at 0x158d0306da0 state=finished raised HTTPStatusError>]
2025-09-17 17:35:47 | ERROR    | app.services.vector_store:add_documents:253 - Failed to add batch to collection: list index out of range in add.
2025-09-17 17:35:47 | ERROR    | app.services.vector_store:add_documents:264 - Failed to add documents to collection kb_91108203: list index out of range in add.
2025-09-17 17:35:47 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:316 - Error processing file 77: list index out of range in add.
2025-09-17 17:36:27 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:182 - Error deleting knowledge base 17: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 17:36:27 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 18:09:59 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:182 - Error deleting knowledge base 24: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 18:09:59 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 18:10:06 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:182 - Error deleting knowledge base 16: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 18:10:06 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 18:11:18 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:182 - Error deleting knowledge base 9: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 18:11:18 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 18:22:00 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:177 - Error deleting knowledge base 15: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 18:22:00 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 18:22:06 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:177 - Error deleting knowledge base 14: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 18:22:06 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 18:22:11 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:177 - Error deleting knowledge base 13: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 18:22:11 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 18:22:13 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:177 - Error deleting knowledge base 13: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 18:22:13 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 18:22:19 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:177 - Error deleting knowledge base 10: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 18:22:19 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 18:22:26 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:177 - Error deleting knowledge base 12: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-17 18:22:26 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to delete knowledge base
2025-09-17 18:23:10 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:318 - Error processing file 81: Vectorization failed: number of vector IDs does not match chunks.
2025-09-17 23:45:37 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:327 - Error processing file 87: Vectorization failed: number of vector IDs does not match chunks.
2025-09-17 23:45:54 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:327 - Error processing file 88: Vectorization failed: number of vector IDs does not match chunks.
2025-09-17 23:46:12 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:327 - Error processing file 89: Vectorization failed: number of vector IDs does not match chunks.
2025-09-17 23:46:22 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:327 - Error processing file 90: Vectorization failed: number of vector IDs does not match chunks.
2025-09-18 08:45:28 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:327 - Error processing file 92: Vectorization failed: number of vector IDs does not match chunks.
2025-09-18 09:19:22 | ERROR    | app.main:general_exception_handler:84 - Unexpected error: cannot import name 'create_chunks' from 'app.services.text_splitter' (C:\Users\97247\Desktop\ecoful-chat\backend\app\services\text_splitter.py)
Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 344
               │     └ 3
               └ <function _main at 0x0000024CC8733A30>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 344
           │    └ <function BaseProcess._bootstrap at 0x0000024CC863E3B0>
           └ <SpawnProcess name='SpawnProcess-1' parent=14320 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000024CC863DA20>
    └ <SpawnProcess name='SpawnProcess-1' parent=14320 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000024CC833F100>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=14320 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=14320 started>
    │    └ <function subprocess_started at 0x0000024CCAB4EC20>
    └ <SpawnProcess name='SpawnProcess-1' parent=14320 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=820, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000024CC833F0D0>>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=820, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
           │       │   │    └ <function Server.serve at 0x0000024CCAB2F880>
           │       │   └ <uvicorn.server.Server object at 0x0000024CC833F0D0>
           │       └ <function run at 0x0000024CC8750940>
           └ <module 'asyncio' from 'C:\\Users\\97247\\miniconda3\\envs\\ecoful\\lib\\asyncio\\__init__.py'>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000024CCAC4C200>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000024CCA42AC20>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 636, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000024CCA42AB90>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 603, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000024CCA430700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000024CCA383A30>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000024CCAC89120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024C81...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000024C81343580>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000024CCAC89120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024C81...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024C81...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000024C813C2290>
          └ <fastapi.applications.FastAPI object at 0x0000024C81343580>

> File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000024C81522CB0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000024C813C2230>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000024C813C2290>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
          │        │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000024C81522CB0>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          └ <starlette.middleware.base._StreamingResponse object at 0x0000024C81461060>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
               │     │                      └ <anyio._backends._asyncio.TaskGroup object at 0x0000024C8156BE80>
               │     └ <function create_task_group at 0x0000024CCABAD090>
               └ <module 'anyio' from 'C:\\Users\\97247\\miniconda3\\envs\\ecoful\\lib\\site-packages\\anyio\\__init__.py'>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
          └ [ImportError("cannot import name 'create_chunks' from 'app.services.text_splitter' (C:\\Users\\97247\\Desktop\\ecoful-chat\\b...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method _StreamingResponse.stream_response of <starlette.middleware.base._StreamingResponse object at...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
                                         └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000024C81522CB0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
              │        │    └ <async_generator object BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.body_stream at 0x0000024C811D3D40>
              │        └ <starlette.middleware.base._StreamingResponse object at 0x0000024C81461060>
              └ b'{"id":94,"filename":"cesi.pdf","file_size":27529,"file_type":"pdf","processing_status":"pending","created_at":"2025-09-18T0...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
          └ ImportError("cannot import name 'create_chunks' from 'app.services.text_splitter' (C:\\Users\\97247\\Desktop\\ecoful-chat\\ba...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024C815228C0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024C81522950>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x0000024C813C21D0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000024C813C2230>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024C815228C0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024C81522950>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000024C813C2170>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x0000024C813C21D0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8080', 'connection': 'keep-alive', 'content-length': '27716', 'sec-ch-ua-platform': '"Windows"', ...
          │    │               │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024C815228C0>
          │    │               │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024C81522950>
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x0000024CCBD9E440>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000024C813C2170>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000024C813C2170...
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024C81522950>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000024C813C2140>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000024C813C2170>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024C815224D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024C81522950>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000024C813C20E0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000024C813C2140>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024C815224D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024C81522950>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000024C81394310>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000024C813C20E0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024C815224D0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024C81522950>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │     └ <function Route.handle at 0x0000024CCBD57880>
          └ APIRoute(path='/api/v1/knowledge-bases/{kb_id}/files', name='upload_file', methods=['POST'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024C815224D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024C81522950>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000024C8138AB90>
          └ APIRoute(path='/api/v1/knowledge-bases/{kb_id}/files', name='upload_file', methods=['POST'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024C815224D0>
          │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024C81522950>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          └ <starlette.responses.JSONResponse object at 0x0000024C8151AFE0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\responses.py", line 174, in __call__
    await self.background()
          │    └ <fastapi.background.BackgroundTasks object at 0x0000024C8156BFA0>
          └ <starlette.responses.JSONResponse object at 0x0000024C8151AFE0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\background.py", line 43, in __call__
    await task()
          └ <starlette.background.BackgroundTask object at 0x0000024C812E4100>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\background.py", line 28, in __call__
    await run_in_threadpool(self.func, *self.args, **self.kwargs)
          │                 │    │      │    │       │    └ {}
          │                 │    │      │    │       └ <starlette.background.BackgroundTask object at 0x0000024C812E4100>
          │                 │    │      │    └ (94, 27)
          │                 │    │      └ <starlette.background.BackgroundTask object at 0x0000024C812E4100>
          │                 │    └ <function process_uploaded_file at 0x0000024C81354CA0>
          │                 └ <starlette.background.BackgroundTask object at 0x0000024C812E4100>
          └ <function run_in_threadpool at 0x0000024CCB073D00>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (94, 27)
                 │     │         │        └ <function process_uploaded_file at 0x0000024C81354CA0>
                 │     │         └ <function run_sync at 0x0000024CCAB6BBE0>
                 │     └ <module 'anyio.to_thread' from 'C:\\Users\\97247\\miniconda3\\envs\\ecoful\\lib\\site-packages\\anyio\\to_thread.py'>
                 └ <module 'anyio' from 'C:\\Users\\97247\\miniconda3\\envs\\ecoful\\lib\\site-packages\\anyio\\__init__.py'>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x0000024CCAB69630>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=ImportError("cannot import name 'create_chunks' from 'app.services.text_splitter' (C:\\Users\\9724...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ (94, 27)
             │       │   └ <function process_uploaded_file at 0x0000024C81354CA0>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x0000024C815928C0>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\knowledge_bases.py", line 229, in process_uploaded_file
    from app.services.text_splitter import create_chunks

ImportError: cannot import name 'create_chunks' from 'app.services.text_splitter' (C:\Users\97247\Desktop\ecoful-chat\backend\app\services\text_splitter.py)
2025-09-18 09:20:55 | ERROR    | app.services.vector_store:add_documents:307 - Failed to add documents to collection kb_8d868d7e: Expected Embeddings to be non-empty list or numpy array, got [] in add.
2025-09-18 09:20:55 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:353 - Error processing file 95: Expected Embeddings to be non-empty list or numpy array, got [] in add.
2025-09-18 09:21:22 | ERROR    | app.services.vector_store:add_documents:307 - Failed to add documents to collection kb_8d868d7e: Expected Embeddings to be non-empty list or numpy array, got [] in add.
2025-09-18 09:21:22 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:353 - Error processing file 96: Expected Embeddings to be non-empty list or numpy array, got [] in add.
2025-09-18 09:22:04 | ERROR    | app.services.vector_store:add_documents:307 - Failed to add documents to collection kb_8d868d7e: Expected Embeddings to be non-empty list or numpy array, got [] in add.
2025-09-18 09:22:04 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:326 - Error processing file 97: Expected Embeddings to be non-empty list or numpy array, got [] in add.
2025-09-18 09:24:30 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-18 09:24:49 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-18 09:30:48 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:326 - Error processing file 98: ChromaVectorStore.add_documents() missing 1 required positional argument: 'metadatas'
2025-09-19 16:30:49 | ERROR    | app.api.v1.endpoints.chat:ask_question:118 - Error in chat: 'VectorStoreManager' object has no attribute 'search_knowledge_base'
2025-09-19 16:30:49 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to process question
2025-09-19 16:32:35 | ERROR    | app.api.v1.endpoints.chat:ask_question:118 - Error in chat: 'VectorStoreManager' object has no attribute 'search_knowledge_base'
2025-09-19 16:32:35 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to process question
2025-09-19 16:34:04 | ERROR    | app.api.v1.endpoints.chat:ask_question:118 - Error in chat: 'VectorStoreManager' object has no attribute 'search_knowledge_base'
2025-09-19 16:34:04 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to process question
2025-09-19 16:44:38 | ERROR    | app.api.v1.endpoints.chat:ask_question:118 - Error in chat: 'VectorStoreManager' object has no attribute 'search_knowledge_base'
2025-09-19 16:44:38 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 500 - Failed to process question
2025-09-19 16:49:36 | ERROR    | app.services.vector_store:get_or_create_collection:151 - Failed to get_or_create_collection kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 16:49:36 | ERROR    | app.services.vector_store:search_knowledge_base:326 - search_knowledge_base error on collection=kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 16:49:53 | ERROR    | app.services.vector_store:get_or_create_collection:151 - Failed to get_or_create_collection kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 16:49:53 | ERROR    | app.services.vector_store:search_knowledge_base:326 - search_knowledge_base error on collection=kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 16:50:13 | ERROR    | app.services.vector_store:get_or_create_collection:151 - Failed to get_or_create_collection kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 16:50:13 | ERROR    | app.services.vector_store:search_knowledge_base:326 - search_knowledge_base error on collection=kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 16:51:38 | ERROR    | app.services.vector_store:get_or_create_collection:151 - Failed to get_or_create_collection kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 16:51:38 | ERROR    | app.services.vector_store:search_knowledge_base:326 - search_knowledge_base error on collection=kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 16:52:19 | ERROR    | app.services.vector_store:get_or_create_collection:151 - Failed to get_or_create_collection kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 16:52:19 | ERROR    | app.services.vector_store:search_knowledge_base:326 - search_knowledge_base error on collection=kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 16:52:43 | ERROR    | app.services.vector_store:get_or_create_collection:151 - Failed to get_or_create_collection kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 16:52:43 | ERROR    | app.services.vector_store:search_knowledge_base:326 - search_knowledge_base error on collection=kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 17:07:49 | ERROR    | app.services.vector_store:get_or_create_collection:151 - Failed to get_or_create_collection kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 17:07:49 | ERROR    | app.services.vector_store:search_knowledge_base:326 - search_knowledge_base error on collection=kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 17:09:01 | ERROR    | app.services.vector_store:get_or_create_collection:151 - Failed to get_or_create_collection kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 17:09:01 | ERROR    | app.services.vector_store:search_knowledge_base:326 - search_knowledge_base error on collection=kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 17:09:50 | ERROR    | app.services.vector_store:get_or_create_collection:151 - Failed to get_or_create_collection kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 17:09:50 | ERROR    | app.services.vector_store:search_knowledge_base:326 - search_knowledge_base error on collection=kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 17:11:33 | ERROR    | app.services.vector_store:get_or_create_collection:151 - Failed to get_or_create_collection kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 17:11:33 | ERROR    | app.services.vector_store:search_knowledge_base:326 - search_knowledge_base error on collection=kb_04ea94b9: Validation error: metadata: Metadata cannot be empty
2025-09-19 17:22:23 | ERROR    | app.services.vector_store:search_knowledge_base:331 - search_knowledge_base error on collection=kb_04ea94b9: Expected include item to be one of documents, embeddings, metadatas, distances, uris, data, got ids in query.
2025-09-22 14:09:15 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 14:09:15 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 14:09:15 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 14:09:21 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 14:09:21 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 14:11:11 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 14:13:00 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 15:54:18 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 15:54:22 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 15:54:27 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 15:54:35 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 16:16:17 | ERROR    | app.services.bailian_client:create_embeddings:100 - HTTP error creating embeddings: 400 - {"error":{"code":"InvalidParameter","param":null,"message":"Range of input length should be [1, 8192]","type":"InvalidParameter"},"id":"d9547e59-64b0-4460-bfda-fd5d31e490f7","request_id":"d9547e59-64b0-4460-bfda-fd5d31e490f7"}
2025-09-22 16:16:23 | ERROR    | app.services.bailian_client:create_embeddings:100 - HTTP error creating embeddings: 400 - {"error":{"code":"InvalidParameter","param":null,"message":"Range of input length should be [1, 8192]","type":"InvalidParameter"},"id":"dfd560ae-d190-4f0c-bddb-c3f2eb6a075c","request_id":"dfd560ae-d190-4f0c-bddb-c3f2eb6a075c"}
2025-09-22 16:16:28 | ERROR    | app.services.bailian_client:create_embeddings:100 - HTTP error creating embeddings: 400 - {"error":{"code":"InvalidParameter","param":null,"message":"Range of input length should be [1, 8192]","type":"InvalidParameter"},"id":"63e1a7f7-8507-466b-bcd4-8ff40487a819","request_id":"63e1a7f7-8507-466b-bcd4-8ff40487a819"}
2025-09-22 16:16:28 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:403 - Error processing file 129: Embedding sub-batch failed at 1: RetryError[<Future at 0x1f6ee1a6530 state=finished raised HTTPStatusError>]
2025-09-22 16:45:12 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 16:45:42 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 16:46:30 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 16:50:37 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 16:51:03 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 16:53:48 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 17:44:30 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-22 17:48:40 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-23 09:47:36 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-23 09:55:15 | ERROR    | app.services.vector_store:search_knowledge_base:348 - search_knowledge_base error on collection=kb_908e31a4: Expected include item to be one of documents, embeddings, metadatas, distances, uris, data, got ids in query.
2025-09-23 09:55:25 | ERROR    | app.services.vector_store:search_knowledge_base:348 - search_knowledge_base error on collection=kb_908e31a4: Expected include item to be one of documents, embeddings, metadatas, distances, uris, data, got ids in query.
2025-09-23 09:58:06 | ERROR    | app.services.vector_store:search_knowledge_base:348 - search_knowledge_base error on collection=kb_ca0f9fd3: Expected include item to be one of documents, embeddings, metadatas, distances, uris, data, got ids in query.
2025-09-23 10:56:54 | ERROR    | app.services.vector_store:search_knowledge_base:345 - search_knowledge_base error on collection=kb_ca0f9fd3: Expected include item to be one of documents, embeddings, metadatas, distances, uris, data, got ids in query.
2025-09-23 10:58:24 | ERROR    | app.services.vector_store:search_knowledge_base:345 - search_knowledge_base error on collection=kb_ca0f9fd3: Expected include item to be one of documents, embeddings, metadatas, distances, uris, data, got ids in query.
2025-09-23 10:59:33 | ERROR    | app.services.vector_store:search_knowledge_base:345 - search_knowledge_base error on collection=kb_ca0f9fd3: Expected include item to be one of documents, embeddings, metadatas, distances, uris, data, got ids in query.
2025-09-23 11:35:56 | ERROR    | app.services.vector_store:search_knowledge_base:344 - search_knowledge_base error on collection=kb_ca0f9fd3: Expected include item to be one of documents, embeddings, metadatas, distances, uris, data, got ids in query.
2025-09-23 11:36:02 | ERROR    | app.api.v1.endpoints.chat:stream_chat_response:228 - Error in stream response: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-23 11:44:22 | ERROR    | app.services.vector_store:search_knowledge_base:344 - search_knowledge_base error on collection=kb_ca0f9fd3: Expected include item to be one of documents, embeddings, metadatas, distances, uris, data, got ids in query.
2025-09-23 11:44:48 | ERROR    | app.services.vector_store:search_knowledge_base:344 - search_knowledge_base error on collection=kb_ca0f9fd3: Expected include item to be one of documents, embeddings, metadatas, distances, uris, data, got ids in query.
2025-09-23 14:23:07 | ERROR    | app.services.bailian_client:create_embeddings:161 - HTTP error on segments batch (0-1): 400 - {"error":{"code":"Arrearage","param":null,"message":"Access denied, please make sure your account is in good standing.","type":"Arrearage"},"id":"5ecac943-4111-419c-a243-5e666ec2a74c","request_id":"5ecac943-4111-419c-a243-5e666ec2a74c"}
2025-09-23 14:23:08 | ERROR    | app.services.bailian_client:create_embeddings:168 - embedding failed on single segment: Client error '400 Bad Request' for url 'https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-09-23 14:23:08 | ERROR    | app.services.vector_store:search_knowledge_base:344 - search_knowledge_base error on collection=kb_ca0f9fd3: Collection expecting embedding with dimension of 1024, got 1536
2025-09-23 14:23:08 | ERROR    | app.services.bailian_client:_process_stream_response:473 - Error processing stream response: Client error '400 Bad Request' for url 'https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-09-23 14:23:08 | ERROR    | app.api.v1.endpoints.chat:stream_chat_response:217 - Error in stream response: Client error '400 Bad Request' for url 'https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-09-23 17:43:18 | ERROR    | app.main:general_exception_handler:84 - Unexpected error: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000024DAA336560>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000024DAA3365F0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 376
               │     └ 3
               └ <function _main at 0x0000024DA7EA3A30>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 376
           │    └ <function BaseProcess._bootstrap at 0x0000024DA7DBE3B0>
           └ <SpawnProcess name='SpawnProcess-7' parent=22820 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000024DA7DBDA20>
    └ <SpawnProcess name='SpawnProcess-7' parent=22820 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000024DA7ABF100>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-7' parent=22820 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-7' parent=22820 started>
    │    └ <function subprocess_started at 0x0000024DAA26EC20>
    └ <SpawnProcess name='SpawnProcess-7' parent=22820 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=448, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000024DA7ABF0D0>>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=448, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
           │       │   │    └ <function Server.serve at 0x0000024DAA24F880>
           │       │   └ <uvicorn.server.Server object at 0x0000024DA7ABF0D0>
           │       └ <function run at 0x0000024DA7EC0940>
           └ <module 'asyncio' from 'C:\\Users\\97247\\miniconda3\\envs\\ecoful\\lib\\asyncio\\__init__.py'>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000024DAA37C200>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000024DA9B3AC20>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 636, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000024DA9B3AB90>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 603, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000024DA9B40700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000024DA9A93A30>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000024DAA3B9120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024DE0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000024DE0B102B0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000024DAA3B9120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024DE0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024DE0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000024DE0A961D0>
          └ <fastapi.applications.FastAPI object at 0x0000024DE0B102B0>

> File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000024DE0C27400>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000024DE0A96230>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000024DE0A961D0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000024DE0C27EB0>
                     │    │             └ <starlette.requests.Request object at 0x0000024DE0CB1FC0>
                     │    └ <function log_requests at 0x0000024DE0A73F40>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000024DE0A96230>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\main.py", line 50, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x0000024DE0CB1FC0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000024DE0C27EB0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
          └ RuntimeError('MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置')

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024DE0B79990>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C27D00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x0000024DE0A96290>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000024DE0A96230>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024DE0B79990>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C27D00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000024DE0A962F0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x0000024DE0A96290>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8080', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'user-agent': 'Mozilla/5.0 ...
          │    │               │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024DE0B79990>
          │    │               │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C27D00>
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x0000024DAB50E440>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000024DE0A962F0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000024DE0A962F0...
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C27D00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000024DE0A96320>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000024DE0A962F0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024DE0B795A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C27D00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000024DE0A96380>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000024DE0A96320>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024DE0B795A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C27D00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000024DE0B103A0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000024DE0A96380>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024DE0B795A0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C27D00>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │     └ <function Route.handle at 0x0000024DAB4C7880>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024DE0B795A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C27D00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000024DE0B030A0>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000024DE0CE17B0>
                     └ <function get_request_handler.<locals>.app at 0x0000024DE0B03010>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000024DAB4C6B90>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x0000024DE0CE1480>, 'file_id': 140, 'request': <starlette.requests.Req...
                 │         └ <function get_file_download_url at 0x0000024DE0A72B00>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000024DE0A97850>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 336, in get_file_download_url
    mc = _get_minio_client()
         └ <function _get_minio_client at 0x0000024DE0A739A0>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 73, in _get_minio_client
    raise RuntimeError("MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置")

RuntimeError: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
2025-09-23 17:43:22 | ERROR    | app.main:general_exception_handler:84 - Unexpected error: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000024DAA336560>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000024DAA3365F0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 376
               │     └ 3
               └ <function _main at 0x0000024DA7EA3A30>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 376
           │    └ <function BaseProcess._bootstrap at 0x0000024DA7DBE3B0>
           └ <SpawnProcess name='SpawnProcess-7' parent=22820 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000024DA7DBDA20>
    └ <SpawnProcess name='SpawnProcess-7' parent=22820 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000024DA7ABF100>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-7' parent=22820 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-7' parent=22820 started>
    │    └ <function subprocess_started at 0x0000024DAA26EC20>
    └ <SpawnProcess name='SpawnProcess-7' parent=22820 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=448, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000024DA7ABF0D0>>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=448, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
           │       │   │    └ <function Server.serve at 0x0000024DAA24F880>
           │       │   └ <uvicorn.server.Server object at 0x0000024DA7ABF0D0>
           │       └ <function run at 0x0000024DA7EC0940>
           └ <module 'asyncio' from 'C:\\Users\\97247\\miniconda3\\envs\\ecoful\\lib\\asyncio\\__init__.py'>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000024DAA37C200>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000024DA9B3AC20>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 636, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000024DA9B3AB90>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 603, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000024DA9B40700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000024DA9A93A30>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000024DAA3B9120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024DE0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000024DE0B102B0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000024DAA3B9120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024DE0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024DE0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000024DE0A961D0>
          └ <fastapi.applications.FastAPI object at 0x0000024DE0B102B0>

> File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000024DE0B79090>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000024DE0A96230>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000024DE0A961D0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000024DE0C729E0>
                     │    │             └ <starlette.requests.Request object at 0x0000024DE0CB2830>
                     │    └ <function log_requests at 0x0000024DE0A73F40>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000024DE0A96230>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\main.py", line 50, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x0000024DE0CB2830>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000024DE0C729E0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
          └ RuntimeError('MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置')

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024DE0E800D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C70AF0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x0000024DE0A96290>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000024DE0A96230>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024DE0E800D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C70AF0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000024DE0A962F0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x0000024DE0A96290>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8080', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'user-agent': 'Mozilla/5.0 ...
          │    │               │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024DE0E800D0>
          │    │               │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C70AF0>
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x0000024DAB50E440>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000024DE0A962F0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000024DE0A962F0...
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C70AF0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000024DE0A96320>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000024DE0A962F0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024DE0E803A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C70AF0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000024DE0A96380>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000024DE0A96320>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024DE0E803A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C70AF0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000024DE0B103A0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000024DE0A96380>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024DE0E803A0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C70AF0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │     └ <function Route.handle at 0x0000024DAB4C7880>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024DE0E803A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0C70AF0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000024DE0B030A0>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000024DE0CB33D0>
                     └ <function get_request_handler.<locals>.app at 0x0000024DE0B03010>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000024DAB4C6B90>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x0000024DE0CB1510>, 'file_id': 140, 'request': <starlette.requests.Req...
                 │         └ <function get_file_download_url at 0x0000024DE0A72B00>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000024DE0A97850>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 336, in get_file_download_url
    mc = _get_minio_client()
         └ <function _get_minio_client at 0x0000024DE0A739A0>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 73, in _get_minio_client
    raise RuntimeError("MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置")

RuntimeError: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
2025-09-23 17:43:24 | ERROR    | app.main:general_exception_handler:84 - Unexpected error: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000024DAA336560>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000024DAA3365F0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 376
               │     └ 3
               └ <function _main at 0x0000024DA7EA3A30>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 376
           │    └ <function BaseProcess._bootstrap at 0x0000024DA7DBE3B0>
           └ <SpawnProcess name='SpawnProcess-7' parent=22820 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000024DA7DBDA20>
    └ <SpawnProcess name='SpawnProcess-7' parent=22820 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000024DA7ABF100>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-7' parent=22820 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-7' parent=22820 started>
    │    └ <function subprocess_started at 0x0000024DAA26EC20>
    └ <SpawnProcess name='SpawnProcess-7' parent=22820 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=448, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000024DA7ABF0D0>>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=448, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
           │       │   │    └ <function Server.serve at 0x0000024DAA24F880>
           │       │   └ <uvicorn.server.Server object at 0x0000024DA7ABF0D0>
           │       └ <function run at 0x0000024DA7EC0940>
           └ <module 'asyncio' from 'C:\\Users\\97247\\miniconda3\\envs\\ecoful\\lib\\asyncio\\__init__.py'>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000024DAA37C200>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000024DA9B3AC20>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 636, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000024DA9B3AB90>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 603, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000024DA9B40700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000024DA9A93A30>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000024DAA3B9120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024DE0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000024DE0B102B0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000024DAA3B9120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024DE0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024DE0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000024DE0A961D0>
          └ <fastapi.applications.FastAPI object at 0x0000024DE0B102B0>

> File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000024DE0E805E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000024DE0A96230>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000024DE0A961D0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000024DE0E801F0>
                     │    │             └ <starlette.requests.Request object at 0x0000024DE0CB24A0>
                     │    └ <function log_requests at 0x0000024DE0A73F40>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000024DE0A96230>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\main.py", line 50, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x0000024DE0CB24A0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000024DE0E801F0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
          └ RuntimeError('MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置')

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024DE0E804C0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0E80280>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x0000024DE0A96290>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000024DE0A96230>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024DE0E804C0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0E80280>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000024DE0A962F0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x0000024DE0A96290>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8080', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'user-agent': 'Mozilla/5.0 ...
          │    │               │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024DE0E804C0>
          │    │               │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0E80280>
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x0000024DAB50E440>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000024DE0A962F0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000024DE0A962F0...
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0E80280>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000024DE0A96320>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000024DE0A962F0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024DE0E80940>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0E80280>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000024DE0A96380>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000024DE0A96320>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024DE0E80940>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0E80280>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000024DE0B103A0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000024DE0A96380>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024DE0E80940>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0E80280>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │     └ <function Route.handle at 0x0000024DAB4C7880>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024DE0E80940>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024DE0E80280>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000024DE0B030A0>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000024DE0CE3280>
                     └ <function get_request_handler.<locals>.app at 0x0000024DE0B03010>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000024DAB4C6B90>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x0000024DE0CE2410>, 'file_id': 140, 'request': <starlette.requests.Req...
                 │         └ <function get_file_download_url at 0x0000024DE0A72B00>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000024DE0A97850>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 336, in get_file_download_url
    mc = _get_minio_client()
         └ <function _get_minio_client at 0x0000024DE0A739A0>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 73, in _get_minio_client
    raise RuntimeError("MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置")

RuntimeError: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
2025-09-23 17:45:38 | ERROR    | app.main:general_exception_handler:84 - Unexpected error: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x00000242ECBE6560>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x00000242ECBE65F0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 372
               │     └ 3
               └ <function _main at 0x00000242EA783A30>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 372
           │    └ <function BaseProcess._bootstrap at 0x00000242EA6BE3B0>
           └ <SpawnProcess name='SpawnProcess-1' parent=49188 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000242EA6BDA20>
    └ <SpawnProcess name='SpawnProcess-1' parent=49188 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000242EA3BF100>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=49188 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=49188 started>
    │    └ <function subprocess_started at 0x00000242ECB1EC20>
    └ <SpawnProcess name='SpawnProcess-1' parent=49188 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=388, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000242EA3BF0D0>>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=388, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
           │       │   │    └ <function Server.serve at 0x00000242ECAFF880>
           │       │   └ <uvicorn.server.Server object at 0x00000242EA3BF0D0>
           │       └ <function run at 0x00000242EA7A0940>
           └ <module 'asyncio' from 'C:\\Users\\97247\\miniconda3\\envs\\ecoful\\lib\\asyncio\\__init__.py'>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x00000242ECC2C200>
           │    └ <function BaseEventLoop.run_until_complete at 0x00000242EC38AC20>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 636, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000242EC38AB90>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 603, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000242EC390700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000242EC2D3A30>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000242ECC69120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000242A3...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000242A39E74C0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000242ECC69120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000242A3...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000242A3...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000242A397A1A0>
          └ <fastapi.applications.FastAPI object at 0x00000242A39E74C0>

> File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000242A3B1C0D0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000242A397A140>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000242A397A1A0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000242A3B1C160>
                     │    │             └ <starlette.requests.Request object at 0x00000242A3AFB0D0>
                     │    └ <function log_requests at 0x00000242A396CDC0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000242A397A140>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\main.py", line 50, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x00000242A3AFB0D0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000242A3B1C160>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
          └ RuntimeError('MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置')

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000242A3B1CB80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1CD30>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x00000242A397A0E0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000242A397A140>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000242A3B1CB80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1CD30>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000242A397A080>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x00000242A397A0E0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8080', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'user-agent': 'Mozilla/5.0 ...
          │    │               │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000242A3B1CB80>
          │    │               │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1CD30>
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x00000242EED8A440>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000242A397A080>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x00000242A397A080...
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1CD30>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000242A397A050>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000242A397A080>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000242A3B1C790>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1CD30>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000242A3979FF0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000242A397A050>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000242A3B1C790>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1CD30>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x00000242A39E75B0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000242A3979FF0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000242A3B1C790>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1CD30>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │     └ <function Route.handle at 0x00000242EED47880>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000242A3B1C790>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1CD30>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000242A396DCF0>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x00000242A3B2EA40>
                     └ <function get_request_handler.<locals>.app at 0x00000242A396DBD0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000242EED46B90>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x00000242A3B2E680>, 'file_id': 140, 'request': <starlette.requests.Req...
                 │         └ <function get_file_download_url at 0x00000242A3902D40>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000242A3978FD0>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 336, in get_file_download_url
    mc = _get_minio_client()
         └ <function _get_minio_client at 0x00000242A3903BE0>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 73, in _get_minio_client
    raise RuntimeError("MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置")

RuntimeError: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
2025-09-23 17:53:28 | ERROR    | app.main:general_exception_handler:84 - Unexpected error: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x00000242ECBE6560>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x00000242ECBE65F0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 372
               │     └ 3
               └ <function _main at 0x00000242EA783A30>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 372
           │    └ <function BaseProcess._bootstrap at 0x00000242EA6BE3B0>
           └ <SpawnProcess name='SpawnProcess-1' parent=49188 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000242EA6BDA20>
    └ <SpawnProcess name='SpawnProcess-1' parent=49188 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000242EA3BF100>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=49188 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=49188 started>
    │    └ <function subprocess_started at 0x00000242ECB1EC20>
    └ <SpawnProcess name='SpawnProcess-1' parent=49188 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=388, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000242EA3BF0D0>>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=388, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
           │       │   │    └ <function Server.serve at 0x00000242ECAFF880>
           │       │   └ <uvicorn.server.Server object at 0x00000242EA3BF0D0>
           │       └ <function run at 0x00000242EA7A0940>
           └ <module 'asyncio' from 'C:\\Users\\97247\\miniconda3\\envs\\ecoful\\lib\\asyncio\\__init__.py'>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x00000242ECC2C200>
           │    └ <function BaseEventLoop.run_until_complete at 0x00000242EC38AC20>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 636, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000242EC38AB90>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 603, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000242EC390700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000242EC2D3A30>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000242ECC69120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000242A3...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000242A39E74C0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000242ECC69120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000242A3...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000242A3...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000242A397A1A0>
          └ <fastapi.applications.FastAPI object at 0x00000242A39E74C0>

> File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000242A3A111B0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000242A397A140>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000242A397A1A0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000242A3B1CAF0>
                     │    │             └ <starlette.requests.Request object at 0x00000242A3B2E770>
                     │    └ <function log_requests at 0x00000242A396CDC0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000242A397A140>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\main.py", line 50, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x00000242A3B2E770>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000242A3B1CAF0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
          └ RuntimeError('MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置')

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000242A3B1C310>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1D240>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x00000242A397A0E0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000242A397A140>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000242A3B1C310>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1D240>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000242A397A080>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x00000242A397A0E0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8080', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'user-agent': 'Mozilla/5.0 ...
          │    │               │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000242A3B1C310>
          │    │               │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1D240>
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x00000242EED8A440>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000242A397A080>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x00000242A397A080...
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1D240>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000242A397A050>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000242A397A080>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000242A3B1C430>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1D240>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000242A3979FF0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000242A397A050>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000242A3B1C430>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1D240>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x00000242A39E75B0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000242A3979FF0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000242A3B1C430>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1D240>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │     └ <function Route.handle at 0x00000242EED47880>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000242A3B1C430>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000242A3B1D240>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000242A396DCF0>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x00000242A3B2F4C0>
                     └ <function get_request_handler.<locals>.app at 0x00000242A396DBD0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000242EED46B90>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x00000242A3B2F160>, 'file_id': 140, 'request': <starlette.requests.Req...
                 │         └ <function get_file_download_url at 0x00000242A3902D40>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000242A3978FD0>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 336, in get_file_download_url
    mc = _get_minio_client()
         └ <function _get_minio_client at 0x00000242A3903BE0>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 73, in _get_minio_client
    raise RuntimeError("MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置")

RuntimeError: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
2025-09-24 19:48:44 | ERROR    | app.main:http_exception_handler:68 - HTTP error: 404 - Not Found
2025-09-24 19:49:43 | ERROR    | app.main:general_exception_handler:84 - Unexpected error: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x00000273D45A6560>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x00000273D45A65F0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 368
               │     └ 3
               └ <function _main at 0x00000273D2113A30>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 368
           │    └ <function BaseProcess._bootstrap at 0x00000273D202E3B0>
           └ <SpawnProcess name='SpawnProcess-1' parent=29552 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000273D202DA20>
    └ <SpawnProcess name='SpawnProcess-1' parent=29552 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000273D1D2F100>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=29552 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=29552 started>
    │    └ <function subprocess_started at 0x00000273D44DEC20>
    └ <SpawnProcess name='SpawnProcess-1' parent=29552 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=384, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000273D1D2F0D0>>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=384, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
           │       │   │    └ <function Server.serve at 0x00000273D44BF880>
           │       │   └ <uvicorn.server.Server object at 0x00000273D1D2F0D0>
           │       └ <function run at 0x00000273D2130940>
           └ <module 'asyncio' from 'C:\\Users\\97247\\miniconda3\\envs\\ecoful\\lib\\asyncio\\__init__.py'>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x00000273D45EC200>
           │    └ <function BaseEventLoop.run_until_complete at 0x00000273D3D9AC20>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 636, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000273D3D9AB90>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 603, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000273D3DA0700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000273D26E3A30>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000273D4629120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002738A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000027389EA7160>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000273D4629120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002738A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002738A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002738AEFDE40>
          └ <fastapi.applications.FastAPI object at 0x0000027389EA7160>

> File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002738AF24550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002738AEFDDE0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002738AEFDE40>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002738AF24CA0>
                     │    │             └ <starlette.requests.Request object at 0x000002738AFDE830>
                     │    └ <function log_requests at 0x0000027389DF9000>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002738AEFDDE0>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\main.py", line 50, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x000002738AFDE830>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002738AF24CA0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
          └ RuntimeError('MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置')

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002738AF24B80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738AF24EE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x000002738AEFDD80>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002738AEFDDE0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002738AF24B80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738AF24EE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000002738AEFDD20>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x000002738AEFDD80>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8080', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'user-agent': 'Mozilla/5.0 ...
          │    │               │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002738AF24B80>
          │    │               │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738AF24EE0>
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x00000273D577A440>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002738AEFDD20>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x000002738AEFDD20...
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738AF24EE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002738AEFDCF0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002738AEFDD20>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002738AFCFF40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738AF24EE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002738AEFDC90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002738AEFDCF0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002738AFCFF40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738AF24EE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000027389EA7250>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002738AEFDC90>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002738AFCFF40>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738AF24EE0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │     └ <function Route.handle at 0x00000273D5737880>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002738AFCFF40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738AF24EE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000027389DFA050>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002738B056680>
                     └ <function get_request_handler.<locals>.app at 0x0000027389DF93F0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000273D5736B90>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000002738B056CB0>, 'file_id': 140, 'request': <starlette.requests.Req...
                 │         └ <function get_file_download_url at 0x0000027389E62DD0>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000027389EA65F0>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 336, in get_file_download_url
    mc = _get_minio_client()
         └ <function _get_minio_client at 0x0000027389E63C70>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 73, in _get_minio_client
    raise RuntimeError("MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置")

RuntimeError: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
2025-09-24 19:51:01 | ERROR    | app.main:general_exception_handler:84 - Unexpected error: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x00000273D45A6560>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x00000273D45A65F0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 368
               │     └ 3
               └ <function _main at 0x00000273D2113A30>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 368
           │    └ <function BaseProcess._bootstrap at 0x00000273D202E3B0>
           └ <SpawnProcess name='SpawnProcess-1' parent=29552 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000273D202DA20>
    └ <SpawnProcess name='SpawnProcess-1' parent=29552 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000273D1D2F100>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=29552 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=29552 started>
    │    └ <function subprocess_started at 0x00000273D44DEC20>
    └ <SpawnProcess name='SpawnProcess-1' parent=29552 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=384, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000273D1D2F0D0>>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=384, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
           │       │   │    └ <function Server.serve at 0x00000273D44BF880>
           │       │   └ <uvicorn.server.Server object at 0x00000273D1D2F0D0>
           │       └ <function run at 0x00000273D2130940>
           └ <module 'asyncio' from 'C:\\Users\\97247\\miniconda3\\envs\\ecoful\\lib\\asyncio\\__init__.py'>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x00000273D45EC200>
           │    └ <function BaseEventLoop.run_until_complete at 0x00000273D3D9AC20>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 636, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000273D3D9AB90>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 603, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000273D3DA0700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000273D26E3A30>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000273D4629120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002738B...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000027389EA7160>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000273D4629120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002738B...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002738B...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002738AEFDE40>
          └ <fastapi.applications.FastAPI object at 0x0000027389EA7160>

> File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002738B1B76D0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002738AEFDDE0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002738AEFDE40>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002738B1B72E0>
                     │    │             └ <starlette.requests.Request object at 0x000002738B25B760>
                     │    └ <function log_requests at 0x0000027389DF9000>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002738AEFDDE0>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\main.py", line 50, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x000002738B25B760>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002738B1B72E0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
          └ RuntimeError('MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置')

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002738B1B7D90>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B7880>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x000002738AEFDD80>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002738AEFDDE0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002738B1B7D90>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B7880>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000002738AEFDD20>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x000002738AEFDD80>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8080', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'user-agent': 'Mozilla/5.0 ...
          │    │               │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002738B1B7D90>
          │    │               │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B7880>
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x00000273D577A440>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002738AEFDD20>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x000002738AEFDD20...
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B7880>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002738AEFDCF0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002738AEFDD20>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002738AFCFF40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B7880>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002738AEFDC90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002738AEFDCF0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002738AFCFF40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B7880>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000027389EA7250>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002738AEFDC90>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002738AFCFF40>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B7880>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │     └ <function Route.handle at 0x00000273D5737880>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002738AFCFF40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B7880>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000027389DFA050>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002738B25A1D0>
                     └ <function get_request_handler.<locals>.app at 0x0000027389DF93F0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000273D5736B90>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000002738B25A530>, 'file_id': 140, 'request': <starlette.requests.Req...
                 │         └ <function get_file_download_url at 0x0000027389E62DD0>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000027389EA65F0>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 336, in get_file_download_url
    mc = _get_minio_client()
         └ <function _get_minio_client at 0x0000027389E63C70>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 73, in _get_minio_client
    raise RuntimeError("MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置")

RuntimeError: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
2025-09-24 19:52:29 | ERROR    | app.main:general_exception_handler:84 - Unexpected error: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x00000273D45A6560>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x00000273D45A65F0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 368
               │     └ 3
               └ <function _main at 0x00000273D2113A30>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 368
           │    └ <function BaseProcess._bootstrap at 0x00000273D202E3B0>
           └ <SpawnProcess name='SpawnProcess-1' parent=29552 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000273D202DA20>
    └ <SpawnProcess name='SpawnProcess-1' parent=29552 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000273D1D2F100>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=29552 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=29552 started>
    │    └ <function subprocess_started at 0x00000273D44DEC20>
    └ <SpawnProcess name='SpawnProcess-1' parent=29552 started>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=384, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000273D1D2F0D0>>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=384, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]
           │       │   │    └ <function Server.serve at 0x00000273D44BF880>
           │       │   └ <uvicorn.server.Server object at 0x00000273D1D2F0D0>
           │       └ <function run at 0x00000273D2130940>
           └ <module 'asyncio' from 'C:\\Users\\97247\\miniconda3\\envs\\ecoful\\lib\\asyncio\\__init__.py'>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x00000273D45EC200>
           │    └ <function BaseEventLoop.run_until_complete at 0x00000273D3D9AC20>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 636, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000273D3D9AB90>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 603, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000273D3DA0700>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000273D26E3A30>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000273D4629120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002738B...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000027389EA7160>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000273D4629120>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002738B...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002738B...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002738AEFDE40>
          └ <fastapi.applications.FastAPI object at 0x0000027389EA7160>

> File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002738B1B7EB0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000027...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002738AEFDDE0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002738AEFDE40>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002738B1B79A0>
                     │    │             └ <starlette.requests.Request object at 0x000002738B258EE0>
                     │    └ <function log_requests at 0x0000027389DF9000>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002738AEFDDE0>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\main.py", line 50, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x000002738B258EE0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002738B1B79A0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
          └ RuntimeError('MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置')

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002738B1E3910>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B77F0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x000002738AEFDD80>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002738AEFDDE0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002738B1E3910>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B77F0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000002738AEFDD20>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x000002738AEFDD80>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8080', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'user-agent': 'Mozilla/5.0 ...
          │    │               │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002738B1E3910>
          │    │               │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B77F0>
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x00000273D577A440>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002738AEFDD20>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x000002738AEFDD20...
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B77F0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002738AEFDCF0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002738AEFDD20>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002738B1E2EF0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B77F0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002738AEFDC90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002738AEFDCF0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002738B1E2EF0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B77F0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000027389EA7250>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002738AEFDC90>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002738B1E2EF0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B77F0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │     └ <function Route.handle at 0x00000273D5737880>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002738B1E2EF0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002738B1B77F0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8080), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000027389DFA050>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/download-url', name='get_file_download_url', methods=['GET'])

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002738B25AC20>
                     └ <function get_request_handler.<locals>.app at 0x0000027389DF93F0>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000273D5736B90>

  File "C:\Users\97247\miniconda3\envs\ecoful\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000002738B25ACB0>, 'file_id': 141, 'request': <starlette.requests.Req...
                 │         └ <function get_file_download_url at 0x0000027389E62DD0>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000027389EA65F0>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 336, in get_file_download_url
    mc = _get_minio_client()
         └ <function _get_minio_client at 0x0000027389E63C70>

  File "C:\Users\97247\Desktop\ecoful-chat\backend\app\api\v1\endpoints\chat.py", line 73, in _get_minio_client
    raise RuntimeError("MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置")

RuntimeError: MINIO_ACCESS_KEY / MINIO_SECRET_KEY 未配置
2025-09-26 08:36:35 | ERROR    | app.api.v1.endpoints.knowledge_bases:list_knowledge_bases:54 - Error listing knowledge bases: password authentication failed for user "postgres"
2025-09-26 08:36:35 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 500 - Failed to list knowledge bases
2025-09-26 08:36:49 | ERROR    | app.api.v1.endpoints.knowledge_bases:list_knowledge_bases:54 - Error listing knowledge bases: password authentication failed for user "postgres"
2025-09-26 08:36:49 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 500 - Failed to list knowledge bases
2025-09-26 08:56:08 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 404 - Not Found
2025-09-26 17:50:10 | ERROR    | app.main:validation_exception_handler:82 - Validation error: [{'type': 'missing', 'loc': ('body', 'knowledge_base_id'), 'msg': 'Field required', 'input': {'kbId': 40, 'question': '你好啊', 'files': [{'uid': 'vc-upload-1758880197523-3'}], 'signal': {}, 'stream': True}, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2025-09-26 17:50:10 | ERROR    | app.main:validation_exception_handler:82 - Validation error: [{'type': 'missing', 'loc': ('body', 'knowledge_base_id'), 'msg': 'Field required', 'input': {'kbId': 40, 'question': '你好啊', 'files': [{'uid': 'vc-upload-1758880197523-3'}]}, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2025-09-26 17:53:13 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 404 - Conversation not found
2025-09-26 17:53:18 | ERROR    | app.main:validation_exception_handler:82 - Validation error: [{'type': 'missing', 'loc': ('body', 'knowledge_base_id'), 'msg': 'Field required', 'input': {'kbId': 40, 'question': '你好啊', 'stream': True}, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2025-09-26 17:53:18 | ERROR    | app.main:validation_exception_handler:82 - Validation error: [{'type': 'missing', 'loc': ('body', 'knowledge_base_id'), 'msg': 'Field required', 'input': {'kbId': 40, 'question': '你好啊'}, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2025-09-28 08:41:46 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 404 - Not Found
2025-09-28 14:57:59 | ERROR    | app.api.v1.endpoints.chat:stream_chat_response:256 - Error in stream response: Instance <ChatConversation at 0x22febd99f10> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-28 14:58:29 | ERROR    | app.api.v1.endpoints.chat:stream_chat_response:256 - Error in stream response: Instance <ChatConversation at 0x22febd9ab10> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-28 15:25:42 | ERROR    | app.api.v1.endpoints.chat:stream_chat_response:258 - Error in stream response: Instance <ChatConversation at 0x149c03958c0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-28 15:26:02 | ERROR    | app.api.v1.endpoints.chat:stream_chat_response:258 - Error in stream response: Instance <ChatConversation at 0x149c03499d0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-28 15:46:19 | ERROR    | app.api.v1.endpoints.chat:stream_chat_response:260 - Error in stream response: Instance <ChatConversation at 0x1e1d0355ae0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-28 15:47:52 | ERROR    | app.api.v1.endpoints.chat:stream_chat_response:260 - Error in stream response: Instance <ChatConversation at 0x1e1d13ab250> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-28 16:13:26 | ERROR    | app.api.v1.endpoints.chat:ask_question:207 - Error in chat: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-28 16:13:26 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 500 - Failed to process question
2025-09-28 16:28:15 | ERROR    | app.api.v1.endpoints.chat:ask_question:220 - Error in chat: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-28 16:28:15 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 500 - Failed to process question
2025-09-28 16:28:40 | ERROR    | app.api.v1.endpoints.chat:ask_question:220 - Error in chat: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-28 16:28:40 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 500 - Failed to process question
2025-09-28 16:28:51 | ERROR    | app.api.v1.endpoints.chat:ask_question:220 - Error in chat: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-09-28 16:28:51 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 500 - Failed to process question
2025-09-28 16:56:38 | ERROR    | app.api.v1.endpoints.knowledge_bases:create_knowledge_base:94 - Error creating knowledge base: MockVectorStoreManager.create_knowledge_base_collection() got an unexpected keyword argument 'collection_name'
2025-09-28 16:56:38 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 500 - Failed to create knowledge base
2025-09-28 23:36:22 | ERROR    | app.services.vector_store:get_or_create_collection:171 - Failed to get_or_create_collection kb_773b3948: '_type'
2025-09-28 23:36:22 | ERROR    | app.api.v1.endpoints.knowledge_bases:create_knowledge_base:128 - Error creating knowledge base: '_type'
2025-09-28 23:36:22 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 500 - Failed to create knowledge base
2025-09-28 23:40:18 | ERROR    | app.services.vector_store:get_or_create_collection:171 - Failed to get_or_create_collection kb_773b3948: '_type'
2025-09-28 23:40:18 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:495 - Error processing file 156: '_type'
2025-09-28 23:55:30 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:222 - Error deleting knowledge base 44: 'ChromaVectorStore' object has no attribute 'delete_collection'
2025-09-28 23:55:30 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 500 - Failed to delete knowledge base
2025-09-28 23:55:50 | ERROR    | app.api.v1.endpoints.knowledge_bases:create_knowledge_base:128 - Error creating knowledge base: 'ChromaVectorStore' object has no attribute 'get_or_create_collection'
2025-09-28 23:55:50 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 500 - Failed to create knowledge base
2025-09-29 08:47:45 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:222 - Error deleting knowledge base 45: 'ChromaVectorStore' object has no attribute 'delete_collection'
2025-09-29 08:47:45 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 500 - Failed to delete knowledge base
2025-09-29 08:47:48 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:222 - Error deleting knowledge base 44: 'ChromaVectorStore' object has no attribute 'delete_collection'
2025-09-29 08:47:48 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 500 - Failed to delete knowledge base
2025-09-29 08:47:55 | ERROR    | app.api.v1.endpoints.knowledge_bases:create_knowledge_base:128 - Error creating knowledge base: 'ChromaVectorStore' object has no attribute 'get_or_create_collection'
2025-09-29 08:47:55 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 500 - Failed to create knowledge base
2025-09-29 08:49:37 | ERROR    | app.api.v1.endpoints.knowledge_bases:delete_knowledge_base:222 - Error deleting knowledge base 46: 'ChromaVectorStore' object has no attribute 'delete_collection'
2025-09-29 08:49:37 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 500 - Failed to delete knowledge base
2025-09-29 08:49:54 | ERROR    | app.api.v1.endpoints.knowledge_bases:create_knowledge_base:128 - Error creating knowledge base: 'ChromaVectorStore' object has no attribute 'get_or_create_collection'
2025-09-29 08:49:54 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 500 - Failed to create knowledge base
2025-09-29 08:50:04 | ERROR    | app.api.v1.endpoints.knowledge_bases:process_uploaded_file:495 - Error processing file 157: 'ChromaVectorStore' object has no attribute 'add_documents'
2025-09-29 06:27:23 | ERROR    | app.main:general_exception_handler:90 - Unexpected error: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455f01610>: Failed to establish a new connection: [Errno 111] Connection refused'))
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           │          └ <function create_connection at 0x7f5479d65c60>
           └ <module 'urllib3.util.connection' from '/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py'>
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
          └ None
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
    │    │       └ ('127.0.0.1', 9000)
    │    └ <method 'connect' of '_socket.socket' objects>
    └ <socket.socket [closed] fd=-1, family=2, type=1, proto=6>

ConnectionRefusedError: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               │    └ <function HTTPConnectionPool._make_request at 0x7f5479cd8f40>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
    │    └ <function HTTPConnection.request at 0x7f5479cdcd60>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455f01610>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 494, in request
    self.endheaders()
    │    └ <function HTTPConnection.endheaders at 0x7f547b18ea20>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455f01610>
  File "/usr/local/lib/python3.11/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    │    │            │                            └ False
    │    │            └ None
    │    └ <function HTTPConnection._send_output at 0x7f547b18e5c0>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455f01610>
  File "/usr/local/lib/python3.11/http/client.py", line 1058, in _send_output
    self.send(msg)
    │    │    └ b'GET /knowledge-base?location= HTTP/1.1\r\nAccept-Encoding: identity\r\nHost: localhost:9000\r\nUser-Agent: MinIO (Linux; x8...
    │    └ <function HTTPConnection.send at 0x7f547b18e3e0>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455f01610>
  File "/usr/local/lib/python3.11/http/client.py", line 996, in send
    self.connect()
    │    └ <function HTTPConnection.connect at 0x7f5479cdc7c0>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455f01610>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 325, in connect
    self.sock = self._new_conn()
    │    │      │    └ <function HTTPConnection._new_conn at 0x7f5479cdc680>
    │    │      └ <urllib3.connection.HTTPConnection object at 0x7f5455f01610>
    │    └ None
    └ <urllib3.connection.HTTPConnection object at 0x7f5455f01610>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
          └ <class 'urllib3.exceptions.NewConnectionError'>

urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7f5455f01610>: Failed to establish a new connection: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 9
               └ <function _main at 0x7f547d0beb60>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f547d15c040>
           └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f547d287560>
    └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f547d078910>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
    │    └ <function subprocess_started at 0x7f547c1af560>
    └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f547c105810>>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f547c1ae5c0>
           │       │   └ <uvicorn.server.Server object at 0x7f547c105810>
           │       └ <function run at 0x7f547c5594e0>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7f547c0d19c0>
           │      └ <function Runner.run at 0x7f547c4ff060>
           └ <asyncio.runners.Runner object at 0x7f547c105010>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7f547c0f2a80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f547c105010>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f547c132f10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f545c0e24...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f545c0...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0x7f545c2eef10>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f547c132f10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f545c0e24...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f545c0...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f545c0e24...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f545c0...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f545c94d810>
          └ <fastapi.applications.FastAPI object at 0x7f545c2eef10>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f545c04b2e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f545c0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f545c2719d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f545c94d810>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7f545c0494e0>
                     │    │             └ <starlette.requests.Request object at 0x7f545c0e2610>
                     │    └ <function log_requests at 0x7f545c2a0360>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f545c2719d0>

  File "/app/app/main.py", line 56, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x7f545c0e2610>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7f545c0494e0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ MaxRetryError("HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Cau...
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f545c0491c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f545c04a700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7f545c26c090>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f545c2719d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f545c0491c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f545c04a700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f545c22cdd0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7f545c26c090>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f545c0491c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f545c04a700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f545c22ef50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f545c22cdd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f545c04b240>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f545c04a700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7f545d3e56d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f545c22ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f545c04b240>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f545c04a700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0x7f545c2ef150>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7f545d3e56d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f545c04b240>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f545c04a700>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │     └ <function Route.handle at 0x7f547af53560>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f545c04b240>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f545c04a700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0x7f545c30b100>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f545c105690>
                     └ <function get_request_handler.<locals>.app at 0x7f545c30b4c0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f547af51b20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x7f545c105810>, 'file_id': 158, 'request': <starlette.requests.Request...
                 │         └ <function get_file_open_url at 0x7f545c2a36a0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f545c149350>

  File "/app/app/api/v1/endpoints/chat.py", line 375, in get_file_open_url
    url = mc.presigned_get_object(
          │  └ <function Minio.presigned_get_object at 0x7f5479b3b920>
          └ <minio.api.Minio object at 0x7f5460801b90>

  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2138, in presigned_get_object
    return self.get_presigned_url(
           │    └ <function Minio.get_presigned_url at 0x7f5479b3b880>
           └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2076, in get_presigned_url
    region = self._get_region(bucket_name)
             │    │           └ 'knowledge-base'
             │    └ <function Minio._get_region at 0x7f5479b39bc0>
             └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 470, in _get_region
    response = self._url_open(
               │    └ <function Minio._url_open at 0x7f5479b39a80>
               └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 279, in _url_open
    response = self._http.urlopen(
               │    │     └ <function PoolManager.urlopen at 0x7f5479cda700>
               │    └ <urllib3.poolmanager.PoolManager object at 0x7f54608018d0>
               └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               │    │       │       │ │              └ {'body': None, 'headers': HTTPHeaderDict({'Host': 'localhost:9000', 'User-Agent': 'MinIO (Linux; x86_64) minio-py/7.2.0', 'x-...
               │    │       │       │ └ <property object at 0x7f5479d8ed90>
               │    │       │       └ Url(scheme='http', auth=None, host='localhost', port=9000, path='/knowledge-base', query='location=', fragment=None)
               │    │       └ 'GET'
               │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x7f5479d7ce00>
              └ Retry(total=0, connect=None, read=None, redirect=None, status=None)
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
          │             │      │    │            └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455f01610>: Failed to establish a new connection: [Errn...
          │             │      │    └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455f01610>: Failed to establish a new connection: [Errn...
          │             │      └ '/knowledge-base?location='
          │             └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455f01610>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-29 06:27:29 | ERROR    | app.main:general_exception_handler:90 - Unexpected error: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455eb3350>: Failed to establish a new connection: [Errno 111] Connection refused'))
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           │          └ <function create_connection at 0x7f5479d65c60>
           └ <module 'urllib3.util.connection' from '/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py'>
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
          └ None
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
    │    │       └ ('127.0.0.1', 9000)
    │    └ <method 'connect' of '_socket.socket' objects>
    └ <socket.socket [closed] fd=-1, family=2, type=1, proto=6>

ConnectionRefusedError: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               │    └ <function HTTPConnectionPool._make_request at 0x7f5479cd8f40>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
    │    └ <function HTTPConnection.request at 0x7f5479cdcd60>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455eb3350>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 494, in request
    self.endheaders()
    │    └ <function HTTPConnection.endheaders at 0x7f547b18ea20>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455eb3350>
  File "/usr/local/lib/python3.11/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    │    │            │                            └ False
    │    │            └ None
    │    └ <function HTTPConnection._send_output at 0x7f547b18e5c0>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455eb3350>
  File "/usr/local/lib/python3.11/http/client.py", line 1058, in _send_output
    self.send(msg)
    │    │    └ b'GET /knowledge-base?location= HTTP/1.1\r\nAccept-Encoding: identity\r\nHost: localhost:9000\r\nUser-Agent: MinIO (Linux; x8...
    │    └ <function HTTPConnection.send at 0x7f547b18e3e0>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455eb3350>
  File "/usr/local/lib/python3.11/http/client.py", line 996, in send
    self.connect()
    │    └ <function HTTPConnection.connect at 0x7f5479cdc7c0>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455eb3350>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 325, in connect
    self.sock = self._new_conn()
    │    │      │    └ <function HTTPConnection._new_conn at 0x7f5479cdc680>
    │    │      └ <urllib3.connection.HTTPConnection object at 0x7f5455eb3350>
    │    └ None
    └ <urllib3.connection.HTTPConnection object at 0x7f5455eb3350>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
          └ <class 'urllib3.exceptions.NewConnectionError'>

urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7f5455eb3350>: Failed to establish a new connection: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 9
               └ <function _main at 0x7f547d0beb60>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f547d15c040>
           └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f547d287560>
    └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f547d078910>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
    │    └ <function subprocess_started at 0x7f547c1af560>
    └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f547c105810>>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f547c1ae5c0>
           │       │   └ <uvicorn.server.Server object at 0x7f547c105810>
           │       └ <function run at 0x7f547c5594e0>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7f547c0d19c0>
           │      └ <function Runner.run at 0x7f547c4ff060>
           └ <asyncio.runners.Runner object at 0x7f547c105010>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7f547c0f2a80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f547c105010>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f547c132f10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e7f3...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0x7f545c2eef10>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f547c132f10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e7f3...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e7f3...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f545c94d810>
          └ <fastapi.applications.FastAPI object at 0x7f545c2eef10>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f545c0c60c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f545c2719d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f545c94d810>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7f545c0c7e20>
                     │    │             └ <starlette.requests.Request object at 0x7f5455e7f590>
                     │    └ <function log_requests at 0x7f545c2a0360>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f545c2719d0>

  File "/app/app/main.py", line 56, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x7f5455e7f590>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7f545c0c7e20>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ MaxRetryError("HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Cau...
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f5455e48540>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e485e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7f545c26c090>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f545c2719d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f5455e48540>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e485e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f545c22cdd0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7f545c26c090>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f5455e48540>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e485e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f545c22ef50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f545c22cdd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f545c0c67a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e485e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7f545d3e56d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f545c22ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f545c0c67a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e485e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0x7f545c2ef150>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7f545d3e56d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f545c0c67a0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e485e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │     └ <function Route.handle at 0x7f547af53560>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f545c0c67a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e485e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0x7f545c30b100>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f5455e7f990>
                     └ <function get_request_handler.<locals>.app at 0x7f545c30b4c0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f547af51b20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x7f5455e7fbd0>, 'file_id': 158, 'request': <starlette.requests.Request...
                 │         └ <function get_file_open_url at 0x7f545c2a36a0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f545c149350>

  File "/app/app/api/v1/endpoints/chat.py", line 375, in get_file_open_url
    url = mc.presigned_get_object(
          │  └ <function Minio.presigned_get_object at 0x7f5479b3b920>
          └ <minio.api.Minio object at 0x7f5460801b90>

  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2138, in presigned_get_object
    return self.get_presigned_url(
           │    └ <function Minio.get_presigned_url at 0x7f5479b3b880>
           └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2076, in get_presigned_url
    region = self._get_region(bucket_name)
             │    │           └ 'knowledge-base'
             │    └ <function Minio._get_region at 0x7f5479b39bc0>
             └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 470, in _get_region
    response = self._url_open(
               │    └ <function Minio._url_open at 0x7f5479b39a80>
               └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 279, in _url_open
    response = self._http.urlopen(
               │    │     └ <function PoolManager.urlopen at 0x7f5479cda700>
               │    └ <urllib3.poolmanager.PoolManager object at 0x7f54608018d0>
               └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               │    │       │       │ │              └ {'body': None, 'headers': HTTPHeaderDict({'Host': 'localhost:9000', 'User-Agent': 'MinIO (Linux; x86_64) minio-py/7.2.0', 'x-...
               │    │       │       │ └ <property object at 0x7f5479d8ed90>
               │    │       │       └ Url(scheme='http', auth=None, host='localhost', port=9000, path='/knowledge-base', query='location=', fragment=None)
               │    │       └ 'GET'
               │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x7f5479d7ce00>
              └ Retry(total=0, connect=None, read=None, redirect=None, status=None)
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
          │             │      │    │            └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455eb3350>: Failed to establish a new connection: [Errn...
          │             │      │    └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455eb3350>: Failed to establish a new connection: [Errn...
          │             │      └ '/knowledge-base?location='
          │             └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455eb3350>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-29 06:27:35 | ERROR    | app.main:general_exception_handler:90 - Unexpected error: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455ec4110>: Failed to establish a new connection: [Errno 111] Connection refused'))
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           │          └ <function create_connection at 0x7f5479d65c60>
           └ <module 'urllib3.util.connection' from '/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py'>
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
          └ None
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
    │    │       └ ('127.0.0.1', 9000)
    │    └ <method 'connect' of '_socket.socket' objects>
    └ <socket.socket [closed] fd=-1, family=2, type=1, proto=6>

ConnectionRefusedError: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               │    └ <function HTTPConnectionPool._make_request at 0x7f5479cd8f40>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
    │    └ <function HTTPConnection.request at 0x7f5479cdcd60>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455ec4110>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 494, in request
    self.endheaders()
    │    └ <function HTTPConnection.endheaders at 0x7f547b18ea20>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455ec4110>
  File "/usr/local/lib/python3.11/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    │    │            │                            └ False
    │    │            └ None
    │    └ <function HTTPConnection._send_output at 0x7f547b18e5c0>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455ec4110>
  File "/usr/local/lib/python3.11/http/client.py", line 1058, in _send_output
    self.send(msg)
    │    │    └ b'GET /knowledge-base?location= HTTP/1.1\r\nAccept-Encoding: identity\r\nHost: localhost:9000\r\nUser-Agent: MinIO (Linux; x8...
    │    └ <function HTTPConnection.send at 0x7f547b18e3e0>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455ec4110>
  File "/usr/local/lib/python3.11/http/client.py", line 996, in send
    self.connect()
    │    └ <function HTTPConnection.connect at 0x7f5479cdc7c0>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455ec4110>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 325, in connect
    self.sock = self._new_conn()
    │    │      │    └ <function HTTPConnection._new_conn at 0x7f5479cdc680>
    │    │      └ <urllib3.connection.HTTPConnection object at 0x7f5455ec4110>
    │    └ None
    └ <urllib3.connection.HTTPConnection object at 0x7f5455ec4110>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
          └ <class 'urllib3.exceptions.NewConnectionError'>

urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7f5455ec4110>: Failed to establish a new connection: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 9
               └ <function _main at 0x7f547d0beb60>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f547d15c040>
           └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f547d287560>
    └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f547d078910>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
    │    └ <function subprocess_started at 0x7f547c1af560>
    └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f547c105810>>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f547c1ae5c0>
           │       │   └ <uvicorn.server.Server object at 0x7f547c105810>
           │       └ <function run at 0x7f547c5594e0>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7f547c0d19c0>
           │      └ <function Runner.run at 0x7f547c4ff060>
           └ <asyncio.runners.Runner object at 0x7f547c105010>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7f547c0f2a80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f547c105010>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f547c132f10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455eb9b...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0x7f545c2eef10>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f547c132f10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455eb9b...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455eb9b...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f545c94d810>
          └ <fastapi.applications.FastAPI object at 0x7f545c2eef10>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f5455e49f80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f545c2719d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f545c94d810>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7f5455e48b80>
                     │    │             └ <starlette.requests.Request object at 0x7f5455eb9d50>
                     │    └ <function log_requests at 0x7f545c2a0360>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f545c2719d0>

  File "/app/app/main.py", line 56, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x7f5455eb9d50>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7f5455e48b80>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ MaxRetryError("HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Cau...
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f5455e48c20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e48ae0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7f545c26c090>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f545c2719d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f5455e48c20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e48ae0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f545c22cdd0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7f545c26c090>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f5455e48c20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e48ae0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f545c22ef50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f545c22cdd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5455e4a0c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e48ae0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7f545d3e56d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f545c22ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5455e4a0c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e48ae0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0x7f545c2ef150>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7f545d3e56d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5455e4a0c0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e48ae0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │     └ <function Route.handle at 0x7f547af53560>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5455e4a0c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e48ae0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0x7f545c30b100>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f5455eb9f50>
                     └ <function get_request_handler.<locals>.app at 0x7f545c30b4c0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f547af51b20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x7f5455eba5d0>, 'file_id': 158, 'request': <starlette.requests.Request...
                 │         └ <function get_file_open_url at 0x7f545c2a36a0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f545c149350>

  File "/app/app/api/v1/endpoints/chat.py", line 375, in get_file_open_url
    url = mc.presigned_get_object(
          │  └ <function Minio.presigned_get_object at 0x7f5479b3b920>
          └ <minio.api.Minio object at 0x7f5460801b90>

  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2138, in presigned_get_object
    return self.get_presigned_url(
           │    └ <function Minio.get_presigned_url at 0x7f5479b3b880>
           └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2076, in get_presigned_url
    region = self._get_region(bucket_name)
             │    │           └ 'knowledge-base'
             │    └ <function Minio._get_region at 0x7f5479b39bc0>
             └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 470, in _get_region
    response = self._url_open(
               │    └ <function Minio._url_open at 0x7f5479b39a80>
               └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 279, in _url_open
    response = self._http.urlopen(
               │    │     └ <function PoolManager.urlopen at 0x7f5479cda700>
               │    └ <urllib3.poolmanager.PoolManager object at 0x7f54608018d0>
               └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               │    │       │       │ │              └ {'body': None, 'headers': HTTPHeaderDict({'Host': 'localhost:9000', 'User-Agent': 'MinIO (Linux; x86_64) minio-py/7.2.0', 'x-...
               │    │       │       │ └ <property object at 0x7f5479d8ed90>
               │    │       │       └ Url(scheme='http', auth=None, host='localhost', port=9000, path='/knowledge-base', query='location=', fragment=None)
               │    │       └ 'GET'
               │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x7f5479d7ce00>
              └ Retry(total=0, connect=None, read=None, redirect=None, status=None)
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
          │             │      │    │            └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455ec4110>: Failed to establish a new connection: [Errn...
          │             │      │    └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455ec4110>: Failed to establish a new connection: [Errn...
          │             │      └ '/knowledge-base?location='
          │             └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455ec4110>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-29 06:27:41 | ERROR    | app.main:general_exception_handler:90 - Unexpected error: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455ef6010>: Failed to establish a new connection: [Errno 111] Connection refused'))
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           │          └ <function create_connection at 0x7f5479d65c60>
           └ <module 'urllib3.util.connection' from '/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py'>
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
          └ None
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
    │    │       └ ('127.0.0.1', 9000)
    │    └ <method 'connect' of '_socket.socket' objects>
    └ <socket.socket [closed] fd=-1, family=2, type=1, proto=6>

ConnectionRefusedError: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               │    └ <function HTTPConnectionPool._make_request at 0x7f5479cd8f40>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
    │    └ <function HTTPConnection.request at 0x7f5479cdcd60>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455ef6010>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 494, in request
    self.endheaders()
    │    └ <function HTTPConnection.endheaders at 0x7f547b18ea20>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455ef6010>
  File "/usr/local/lib/python3.11/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    │    │            │                            └ False
    │    │            └ None
    │    └ <function HTTPConnection._send_output at 0x7f547b18e5c0>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455ef6010>
  File "/usr/local/lib/python3.11/http/client.py", line 1058, in _send_output
    self.send(msg)
    │    │    └ b'GET /knowledge-base?location= HTTP/1.1\r\nAccept-Encoding: identity\r\nHost: localhost:9000\r\nUser-Agent: MinIO (Linux; x8...
    │    └ <function HTTPConnection.send at 0x7f547b18e3e0>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455ef6010>
  File "/usr/local/lib/python3.11/http/client.py", line 996, in send
    self.connect()
    │    └ <function HTTPConnection.connect at 0x7f5479cdc7c0>
    └ <urllib3.connection.HTTPConnection object at 0x7f5455ef6010>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 325, in connect
    self.sock = self._new_conn()
    │    │      │    └ <function HTTPConnection._new_conn at 0x7f5479cdc680>
    │    │      └ <urllib3.connection.HTTPConnection object at 0x7f5455ef6010>
    │    └ None
    └ <urllib3.connection.HTTPConnection object at 0x7f5455ef6010>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
          └ <class 'urllib3.exceptions.NewConnectionError'>

urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7f5455ef6010>: Failed to establish a new connection: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 9
               └ <function _main at 0x7f547d0beb60>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f547d15c040>
           └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f547d287560>
    └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f547d078910>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
    │    └ <function subprocess_started at 0x7f547c1af560>
    └ <SpawnProcess name='SpawnProcess-3' parent=1 started>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f547c105810>>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f547c1ae5c0>
           │       │   └ <uvicorn.server.Server object at 0x7f547c105810>
           │       └ <function run at 0x7f547c5594e0>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7f547c0d19c0>
           │      └ <function Runner.run at 0x7f547c4ff060>
           └ <asyncio.runners.Runner object at 0x7f547c105010>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7f547c0f2a80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f547c105010>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f547c132f10>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e9cc...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0x7f545c2eef10>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f547c132f10>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e9cc...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e9cc...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f545c94d810>
          └ <fastapi.applications.FastAPI object at 0x7f545c2eef10>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f5455e48ea0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5455e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f545c2719d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f545c94d810>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7f5455e48f40>
                     │    │             └ <starlette.requests.Request object at 0x7f5455e9ce90>
                     │    └ <function log_requests at 0x7f545c2a0360>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f545c2719d0>

  File "/app/app/main.py", line 56, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x7f5455e9ce90>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7f5455e48f40>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ MaxRetryError("HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Cau...
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f5455e49120>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e48fe0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7f545c26c090>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f545c2719d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f5455e49120>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e48fe0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f545c22cdd0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7f545c26c090>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f5455e49120>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e48fe0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f545c22ef50>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f545c22cdd0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5455e48900>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e48fe0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7f545d3e56d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f545c22ef50>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5455e48900>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e48fe0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0x7f545c2ef150>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7f545d3e56d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5455e48900>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e48fe0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │     └ <function Route.handle at 0x7f547af53560>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5455e48900>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f5455e48fe0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0x7f545c30b100>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f5455e9d550>
                     └ <function get_request_handler.<locals>.app at 0x7f545c30b4c0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f547af51b20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x7f5455e9d810>, 'file_id': 159, 'request': <starlette.requests.Request...
                 │         └ <function get_file_open_url at 0x7f545c2a36a0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f545c149350>

  File "/app/app/api/v1/endpoints/chat.py", line 375, in get_file_open_url
    url = mc.presigned_get_object(
          │  └ <function Minio.presigned_get_object at 0x7f5479b3b920>
          └ <minio.api.Minio object at 0x7f5460801b90>

  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2138, in presigned_get_object
    return self.get_presigned_url(
           │    └ <function Minio.get_presigned_url at 0x7f5479b3b880>
           └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2076, in get_presigned_url
    region = self._get_region(bucket_name)
             │    │           └ 'knowledge-base'
             │    └ <function Minio._get_region at 0x7f5479b39bc0>
             └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 470, in _get_region
    response = self._url_open(
               │    └ <function Minio._url_open at 0x7f5479b39a80>
               └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 279, in _url_open
    response = self._http.urlopen(
               │    │     └ <function PoolManager.urlopen at 0x7f5479cda700>
               │    └ <urllib3.poolmanager.PoolManager object at 0x7f54608018d0>
               └ <minio.api.Minio object at 0x7f5460801b90>
  File "/usr/local/lib/python3.11/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               │    │       │       │ │              └ {'body': None, 'headers': HTTPHeaderDict({'Host': 'localhost:9000', 'User-Agent': 'MinIO (Linux; x86_64) minio-py/7.2.0', 'x-...
               │    │       │       │ └ <property object at 0x7f5479d8ed90>
               │    │       │       └ Url(scheme='http', auth=None, host='localhost', port=9000, path='/knowledge-base', query='location=', fragment=None)
               │    │       └ 'GET'
               │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7f5479cd9120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x7f5479d7ce00>
              └ Retry(total=0, connect=None, read=None, redirect=None, status=None)
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
          │             │      │    │            └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455ef6010>: Failed to establish a new connection: [Errn...
          │             │      │    └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455ef6010>: Failed to establish a new connection: [Errn...
          │             │      └ '/knowledge-base?location='
          │             └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7f545c0d9510>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5455ef6010>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-29 06:28:27 | ERROR    | app.main:general_exception_handler:90 - Unexpected error: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c68b8d0>: Failed to establish a new connection: [Errno 111] Connection refused'))
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           │          └ <function create_connection at 0x7deb70509c60>
           └ <module 'urllib3.util.connection' from '/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py'>
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
          └ None
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
    │    │       └ ('127.0.0.1', 9000)
    │    └ <method 'connect' of '_socket.socket' objects>
    └ <socket.socket [closed] fd=-1, family=2, type=1, proto=6>

ConnectionRefusedError: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               │    └ <function HTTPConnectionPool._make_request at 0x7deb70428f40>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
    │    └ <function HTTPConnection.request at 0x7deb7042cd60>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c68b8d0>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 494, in request
    self.endheaders()
    │    └ <function HTTPConnection.endheaders at 0x7deb718e2a20>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c68b8d0>
  File "/usr/local/lib/python3.11/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    │    │            │                            └ False
    │    │            └ None
    │    └ <function HTTPConnection._send_output at 0x7deb718e25c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c68b8d0>
  File "/usr/local/lib/python3.11/http/client.py", line 1058, in _send_output
    self.send(msg)
    │    │    └ b'GET /knowledge-base?location= HTTP/1.1\r\nAccept-Encoding: identity\r\nHost: localhost:9000\r\nUser-Agent: MinIO (Linux; x8...
    │    └ <function HTTPConnection.send at 0x7deb718e23e0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c68b8d0>
  File "/usr/local/lib/python3.11/http/client.py", line 996, in send
    self.connect()
    │    └ <function HTTPConnection.connect at 0x7deb7042c7c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c68b8d0>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 325, in connect
    self.sock = self._new_conn()
    │    │      │    └ <function HTTPConnection._new_conn at 0x7deb7042c680>
    │    │      └ <urllib3.connection.HTTPConnection object at 0x7deb4c68b8d0>
    │    └ None
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c68b8d0>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
          └ <class 'urllib3.exceptions.NewConnectionError'>

urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7deb4c68b8d0>: Failed to establish a new connection: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7deb7381eb60>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7deb738bc040>
           └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7deb739e7560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7deb737d8910>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    └ <function subprocess_started at 0x7deb7290f560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7deb72865990>>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x7deb7290e5c0>
           │       │   └ <uvicorn.server.Server object at 0x7deb72865990>
           │       └ <function run at 0x7deb72cb94e0>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7deb728319c0>
           │      └ <function Runner.run at 0x7deb72c5f060>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7deb72852a80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c689d...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c6...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c689d...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c6...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c689d...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c6...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
          └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7deb4ea40e00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c6...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4e82eac0>
                     │    │             └ <starlette.requests.Request object at 0x7deb4c68b9d0>
                     │    └ <function log_requests at 0x7deb4ea022a0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>

  File "/app/app/main.py", line 56, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x7deb4c68b9d0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4e82eac0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ MaxRetryError("HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Cau...
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4e82e200>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4e82e7a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4e82e200>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4e82e7a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4e82e200>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4e82e7a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4e866d40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4e82e7a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4e866d40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4e82e7a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0x7deb4e90a850>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4e866d40>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4e82e7a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │     └ <function Route.handle at 0x7deb716b7560>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4e866d40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4e82e7a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0x7deb4e92f6a0>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7deb4e86a7d0>
                     └ <function get_request_handler.<locals>.app at 0x7deb4e92f740>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7deb716b5b20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x7deb4e869c90>, 'file_id': 158, 'request': <starlette.requests.Request...
                 │         └ <function get_file_open_url at 0x7deb4ea42840>
                 └ <fastapi.dependencies.models.Dependant object at 0x7deb4e94c510>

  File "/app/app/api/v1/endpoints/chat.py", line 375, in get_file_open_url
    url = mc.presigned_get_object(
          │  └ <function Minio.presigned_get_object at 0x7deb70293920>
          └ <minio.api.Minio object at 0x7deb56f5c750>

  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2138, in presigned_get_object
    return self.get_presigned_url(
           │    └ <function Minio.get_presigned_url at 0x7deb70293880>
           └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2076, in get_presigned_url
    region = self._get_region(bucket_name)
             │    │           └ 'knowledge-base'
             │    └ <function Minio._get_region at 0x7deb70291bc0>
             └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 470, in _get_region
    response = self._url_open(
               │    └ <function Minio._url_open at 0x7deb70291a80>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 279, in _url_open
    response = self._http.urlopen(
               │    │     └ <function PoolManager.urlopen at 0x7deb7042a700>
               │    └ <urllib3.poolmanager.PoolManager object at 0x7deb56f5dd50>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               │    │       │       │ │              └ {'body': None, 'headers': HTTPHeaderDict({'Host': 'localhost:9000', 'User-Agent': 'MinIO (Linux; x86_64) minio-py/7.2.0', 'x-...
               │    │       │       │ └ <property object at 0x7deb70556ca0>
               │    │       │       └ Url(scheme='http', auth=None, host='localhost', port=9000, path='/knowledge-base', query='location=', fragment=None)
               │    │       └ 'GET'
               │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x7deb704f0e00>
              └ Retry(total=0, connect=None, read=None, redirect=None, status=None)
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
          │             │      │    │            └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c68b8d0>: Failed to establish a new connection: [Errn...
          │             │      │    └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c68b8d0>: Failed to establish a new connection: [Errn...
          │             │      └ '/knowledge-base?location='
          │             └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c68b8d0>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-29 06:28:33 | ERROR    | app.main:general_exception_handler:90 - Unexpected error: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c662350>: Failed to establish a new connection: [Errno 111] Connection refused'))
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           │          └ <function create_connection at 0x7deb70509c60>
           └ <module 'urllib3.util.connection' from '/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py'>
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
          └ None
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
    │    │       └ ('127.0.0.1', 9000)
    │    └ <method 'connect' of '_socket.socket' objects>
    └ <socket.socket [closed] fd=-1, family=2, type=1, proto=6>

ConnectionRefusedError: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               │    └ <function HTTPConnectionPool._make_request at 0x7deb70428f40>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
    │    └ <function HTTPConnection.request at 0x7deb7042cd60>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c662350>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 494, in request
    self.endheaders()
    │    └ <function HTTPConnection.endheaders at 0x7deb718e2a20>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c662350>
  File "/usr/local/lib/python3.11/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    │    │            │                            └ False
    │    │            └ None
    │    └ <function HTTPConnection._send_output at 0x7deb718e25c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c662350>
  File "/usr/local/lib/python3.11/http/client.py", line 1058, in _send_output
    self.send(msg)
    │    │    └ b'GET /knowledge-base?location= HTTP/1.1\r\nAccept-Encoding: identity\r\nHost: localhost:9000\r\nUser-Agent: MinIO (Linux; x8...
    │    └ <function HTTPConnection.send at 0x7deb718e23e0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c662350>
  File "/usr/local/lib/python3.11/http/client.py", line 996, in send
    self.connect()
    │    └ <function HTTPConnection.connect at 0x7deb7042c7c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c662350>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 325, in connect
    self.sock = self._new_conn()
    │    │      │    └ <function HTTPConnection._new_conn at 0x7deb7042c680>
    │    │      └ <urllib3.connection.HTTPConnection object at 0x7deb4c662350>
    │    └ None
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c662350>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
          └ <class 'urllib3.exceptions.NewConnectionError'>

urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7deb4c662350>: Failed to establish a new connection: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7deb7381eb60>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7deb738bc040>
           └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7deb739e7560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7deb737d8910>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    └ <function subprocess_started at 0x7deb7290f560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7deb72865990>>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x7deb7290e5c0>
           │       │   └ <uvicorn.server.Server object at 0x7deb72865990>
           │       └ <function run at 0x7deb72cb94e0>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7deb728319c0>
           │      └ <function Runner.run at 0x7deb72c5f060>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7deb72852a80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c64cf...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c6...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c64cf...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c6...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c64cf...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c6...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
          └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7deb4c6af600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c6...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4c6af6a0>
                     │    │             └ <starlette.requests.Request object at 0x7deb4c64d110>
                     │    └ <function log_requests at 0x7deb4ea022a0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>

  File "/app/app/main.py", line 56, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x7deb4c64d110>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4c6af6a0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ MaxRetryError("HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Cau...
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c6afb00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c6af9c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c6afb00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c6af9c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c6afb00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c6af9c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c6afd80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c6af9c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c6afd80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c6af9c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0x7deb4e90a850>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c6afd80>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c6af9c0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │     └ <function Route.handle at 0x7deb716b7560>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c6afd80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c6af9c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0x7deb4e92f6a0>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7deb4c642fd0>
                     └ <function get_request_handler.<locals>.app at 0x7deb4e92f740>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7deb716b5b20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x7deb4c640450>, 'file_id': 159, 'request': <starlette.requests.Request...
                 │         └ <function get_file_open_url at 0x7deb4ea42840>
                 └ <fastapi.dependencies.models.Dependant object at 0x7deb4e94c510>

  File "/app/app/api/v1/endpoints/chat.py", line 375, in get_file_open_url
    url = mc.presigned_get_object(
          │  └ <function Minio.presigned_get_object at 0x7deb70293920>
          └ <minio.api.Minio object at 0x7deb56f5c750>

  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2138, in presigned_get_object
    return self.get_presigned_url(
           │    └ <function Minio.get_presigned_url at 0x7deb70293880>
           └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2076, in get_presigned_url
    region = self._get_region(bucket_name)
             │    │           └ 'knowledge-base'
             │    └ <function Minio._get_region at 0x7deb70291bc0>
             └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 470, in _get_region
    response = self._url_open(
               │    └ <function Minio._url_open at 0x7deb70291a80>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 279, in _url_open
    response = self._http.urlopen(
               │    │     └ <function PoolManager.urlopen at 0x7deb7042a700>
               │    └ <urllib3.poolmanager.PoolManager object at 0x7deb56f5dd50>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               │    │       │       │ │              └ {'body': None, 'headers': HTTPHeaderDict({'Host': 'localhost:9000', 'User-Agent': 'MinIO (Linux; x86_64) minio-py/7.2.0', 'x-...
               │    │       │       │ └ <property object at 0x7deb70556ca0>
               │    │       │       └ Url(scheme='http', auth=None, host='localhost', port=9000, path='/knowledge-base', query='location=', fragment=None)
               │    │       └ 'GET'
               │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x7deb704f0e00>
              └ Retry(total=0, connect=None, read=None, redirect=None, status=None)
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
          │             │      │    │            └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c662350>: Failed to establish a new connection: [Errn...
          │             │      │    └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c662350>: Failed to establish a new connection: [Errn...
          │             │      └ '/knowledge-base?location='
          │             └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c662350>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-29 06:28:54 | ERROR    | app.main:general_exception_handler:90 - Unexpected error: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4a6a90>: Failed to establish a new connection: [Errno 111] Connection refused'))
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           │          └ <function create_connection at 0x7deb70509c60>
           └ <module 'urllib3.util.connection' from '/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py'>
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
          └ None
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
    │    │       └ ('127.0.0.1', 9000)
    │    └ <method 'connect' of '_socket.socket' objects>
    └ <socket.socket [closed] fd=-1, family=2, type=1, proto=6>

ConnectionRefusedError: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               │    └ <function HTTPConnectionPool._make_request at 0x7deb70428f40>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
    │    └ <function HTTPConnection.request at 0x7deb7042cd60>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4a6a90>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 494, in request
    self.endheaders()
    │    └ <function HTTPConnection.endheaders at 0x7deb718e2a20>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4a6a90>
  File "/usr/local/lib/python3.11/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    │    │            │                            └ False
    │    │            └ None
    │    └ <function HTTPConnection._send_output at 0x7deb718e25c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4a6a90>
  File "/usr/local/lib/python3.11/http/client.py", line 1058, in _send_output
    self.send(msg)
    │    │    └ b'GET /knowledge-base?location= HTTP/1.1\r\nAccept-Encoding: identity\r\nHost: localhost:9000\r\nUser-Agent: MinIO (Linux; x8...
    │    └ <function HTTPConnection.send at 0x7deb718e23e0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4a6a90>
  File "/usr/local/lib/python3.11/http/client.py", line 996, in send
    self.connect()
    │    └ <function HTTPConnection.connect at 0x7deb7042c7c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4a6a90>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 325, in connect
    self.sock = self._new_conn()
    │    │      │    └ <function HTTPConnection._new_conn at 0x7deb7042c680>
    │    │      └ <urllib3.connection.HTTPConnection object at 0x7deb4c4a6a90>
    │    └ None
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4a6a90>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
          └ <class 'urllib3.exceptions.NewConnectionError'>

urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7deb4c4a6a90>: Failed to establish a new connection: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7deb7381eb60>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7deb738bc040>
           └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7deb739e7560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7deb737d8910>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    └ <function subprocess_started at 0x7deb7290f560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7deb72865990>>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x7deb7290e5c0>
           │       │   └ <uvicorn.server.Server object at 0x7deb72865990>
           │       └ <function run at 0x7deb72cb94e0>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7deb728319c0>
           │      └ <function Runner.run at 0x7deb72c5f060>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7deb72852a80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c64c7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c6...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c64c7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c6...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c64c7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c6...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
          └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7deb4e867b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c6...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4e867ba0>
                     │    │             └ <starlette.requests.Request object at 0x7deb4c475ad0>
                     │    └ <function log_requests at 0x7deb4ea022a0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>

  File "/app/app/main.py", line 56, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x7deb4c475ad0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4e867ba0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ MaxRetryError("HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Cau...
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4e867c40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4e8679c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4e867c40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4e8679c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4e867c40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4e8679c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4e865f80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4e8679c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4e865f80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4e8679c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0x7deb4e90a850>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4e865f80>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4e8679c0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │     └ <function Route.handle at 0x7deb716b7560>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4e865f80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4e8679c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0x7deb4e92f6a0>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7deb4c69ff90>
                     └ <function get_request_handler.<locals>.app at 0x7deb4e92f740>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7deb716b5b20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x7deb4c69fcd0>, 'file_id': 158, 'request': <starlette.requests.Request...
                 │         └ <function get_file_open_url at 0x7deb4ea42840>
                 └ <fastapi.dependencies.models.Dependant object at 0x7deb4e94c510>

  File "/app/app/api/v1/endpoints/chat.py", line 375, in get_file_open_url
    url = mc.presigned_get_object(
          │  └ <function Minio.presigned_get_object at 0x7deb70293920>
          └ <minio.api.Minio object at 0x7deb56f5c750>

  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2138, in presigned_get_object
    return self.get_presigned_url(
           │    └ <function Minio.get_presigned_url at 0x7deb70293880>
           └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2076, in get_presigned_url
    region = self._get_region(bucket_name)
             │    │           └ 'knowledge-base'
             │    └ <function Minio._get_region at 0x7deb70291bc0>
             └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 470, in _get_region
    response = self._url_open(
               │    └ <function Minio._url_open at 0x7deb70291a80>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 279, in _url_open
    response = self._http.urlopen(
               │    │     └ <function PoolManager.urlopen at 0x7deb7042a700>
               │    └ <urllib3.poolmanager.PoolManager object at 0x7deb56f5dd50>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               │    │       │       │ │              └ {'body': None, 'headers': HTTPHeaderDict({'Host': 'localhost:9000', 'User-Agent': 'MinIO (Linux; x86_64) minio-py/7.2.0', 'x-...
               │    │       │       │ └ <property object at 0x7deb70556ca0>
               │    │       │       └ Url(scheme='http', auth=None, host='localhost', port=9000, path='/knowledge-base', query='location=', fragment=None)
               │    │       └ 'GET'
               │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x7deb704f0e00>
              └ Retry(total=0, connect=None, read=None, redirect=None, status=None)
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
          │             │      │    │            └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4a6a90>: Failed to establish a new connection: [Errn...
          │             │      │    └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4a6a90>: Failed to establish a new connection: [Errn...
          │             │      └ '/knowledge-base?location='
          │             └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4a6a90>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-29 06:29:00 | ERROR    | app.main:general_exception_handler:90 - Unexpected error: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4cec10>: Failed to establish a new connection: [Errno 111] Connection refused'))
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           │          └ <function create_connection at 0x7deb70509c60>
           └ <module 'urllib3.util.connection' from '/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py'>
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
          └ None
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
    │    │       └ ('127.0.0.1', 9000)
    │    └ <method 'connect' of '_socket.socket' objects>
    └ <socket.socket [closed] fd=-1, family=2, type=1, proto=6>

ConnectionRefusedError: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               │    └ <function HTTPConnectionPool._make_request at 0x7deb70428f40>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
    │    └ <function HTTPConnection.request at 0x7deb7042cd60>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4cec10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 494, in request
    self.endheaders()
    │    └ <function HTTPConnection.endheaders at 0x7deb718e2a20>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4cec10>
  File "/usr/local/lib/python3.11/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    │    │            │                            └ False
    │    │            └ None
    │    └ <function HTTPConnection._send_output at 0x7deb718e25c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4cec10>
  File "/usr/local/lib/python3.11/http/client.py", line 1058, in _send_output
    self.send(msg)
    │    │    └ b'GET /knowledge-base?location= HTTP/1.1\r\nAccept-Encoding: identity\r\nHost: localhost:9000\r\nUser-Agent: MinIO (Linux; x8...
    │    └ <function HTTPConnection.send at 0x7deb718e23e0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4cec10>
  File "/usr/local/lib/python3.11/http/client.py", line 996, in send
    self.connect()
    │    └ <function HTTPConnection.connect at 0x7deb7042c7c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4cec10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 325, in connect
    self.sock = self._new_conn()
    │    │      │    └ <function HTTPConnection._new_conn at 0x7deb7042c680>
    │    │      └ <urllib3.connection.HTTPConnection object at 0x7deb4c4cec10>
    │    └ None
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4cec10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
          └ <class 'urllib3.exceptions.NewConnectionError'>

urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7deb4c4cec10>: Failed to establish a new connection: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7deb7381eb60>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7deb738bc040>
           └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7deb739e7560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7deb737d8910>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    └ <function subprocess_started at 0x7deb7290f560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7deb72865990>>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x7deb7290e5c0>
           │       │   └ <uvicorn.server.Server object at 0x7deb72865990>
           │       └ <function run at 0x7deb72cb94e0>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7deb728319c0>
           │      └ <function Runner.run at 0x7deb72c5f060>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7deb72852a80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4a7c...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4a7c...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4a7c...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
          └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7deb4c6ac040>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4c6af240>
                     │    │             └ <starlette.requests.Request object at 0x7deb4c689010>
                     │    └ <function log_requests at 0x7deb4ea022a0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>

  File "/app/app/main.py", line 56, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x7deb4c689010>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4c6af240>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ MaxRetryError("HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Cau...
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c65f4c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c6af1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c65f4c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c6af1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c65f4c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c6af1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c65f420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c6af1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c65f420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c6af1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0x7deb4e90a850>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c65f420>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c6af1a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │     └ <function Route.handle at 0x7deb716b7560>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c65f420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c6af1a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0x7deb4e92f6a0>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7deb4c4b4110>
                     └ <function get_request_handler.<locals>.app at 0x7deb4e92f740>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7deb716b5b20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x7deb4c4b4310>, 'file_id': 159, 'request': <starlette.requests.Request...
                 │         └ <function get_file_open_url at 0x7deb4ea42840>
                 └ <fastapi.dependencies.models.Dependant object at 0x7deb4e94c510>

  File "/app/app/api/v1/endpoints/chat.py", line 375, in get_file_open_url
    url = mc.presigned_get_object(
          │  └ <function Minio.presigned_get_object at 0x7deb70293920>
          └ <minio.api.Minio object at 0x7deb56f5c750>

  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2138, in presigned_get_object
    return self.get_presigned_url(
           │    └ <function Minio.get_presigned_url at 0x7deb70293880>
           └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2076, in get_presigned_url
    region = self._get_region(bucket_name)
             │    │           └ 'knowledge-base'
             │    └ <function Minio._get_region at 0x7deb70291bc0>
             └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 470, in _get_region
    response = self._url_open(
               │    └ <function Minio._url_open at 0x7deb70291a80>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 279, in _url_open
    response = self._http.urlopen(
               │    │     └ <function PoolManager.urlopen at 0x7deb7042a700>
               │    └ <urllib3.poolmanager.PoolManager object at 0x7deb56f5dd50>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               │    │       │       │ │              └ {'body': None, 'headers': HTTPHeaderDict({'Host': 'localhost:9000', 'User-Agent': 'MinIO (Linux; x86_64) minio-py/7.2.0', 'x-...
               │    │       │       │ └ <property object at 0x7deb70556ca0>
               │    │       │       └ Url(scheme='http', auth=None, host='localhost', port=9000, path='/knowledge-base', query='location=', fragment=None)
               │    │       └ 'GET'
               │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x7deb704f0e00>
              └ Retry(total=0, connect=None, read=None, redirect=None, status=None)
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
          │             │      │    │            └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4cec10>: Failed to establish a new connection: [Errn...
          │             │      │    └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4cec10>: Failed to establish a new connection: [Errn...
          │             │      └ '/knowledge-base?location='
          │             └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4cec10>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-29 06:29:06 | ERROR    | app.main:general_exception_handler:90 - Unexpected error: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4df410>: Failed to establish a new connection: [Errno 111] Connection refused'))
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           │          └ <function create_connection at 0x7deb70509c60>
           └ <module 'urllib3.util.connection' from '/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py'>
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
          └ None
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
    │    │       └ ('127.0.0.1', 9000)
    │    └ <method 'connect' of '_socket.socket' objects>
    └ <socket.socket [closed] fd=-1, family=2, type=1, proto=6>

ConnectionRefusedError: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               │    └ <function HTTPConnectionPool._make_request at 0x7deb70428f40>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
    │    └ <function HTTPConnection.request at 0x7deb7042cd60>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4df410>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 494, in request
    self.endheaders()
    │    └ <function HTTPConnection.endheaders at 0x7deb718e2a20>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4df410>
  File "/usr/local/lib/python3.11/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    │    │            │                            └ False
    │    │            └ None
    │    └ <function HTTPConnection._send_output at 0x7deb718e25c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4df410>
  File "/usr/local/lib/python3.11/http/client.py", line 1058, in _send_output
    self.send(msg)
    │    │    └ b'GET /knowledge-base?location= HTTP/1.1\r\nAccept-Encoding: identity\r\nHost: localhost:9000\r\nUser-Agent: MinIO (Linux; x8...
    │    └ <function HTTPConnection.send at 0x7deb718e23e0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4df410>
  File "/usr/local/lib/python3.11/http/client.py", line 996, in send
    self.connect()
    │    └ <function HTTPConnection.connect at 0x7deb7042c7c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4df410>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 325, in connect
    self.sock = self._new_conn()
    │    │      │    └ <function HTTPConnection._new_conn at 0x7deb7042c680>
    │    │      └ <urllib3.connection.HTTPConnection object at 0x7deb4c4df410>
    │    └ None
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4df410>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
          └ <class 'urllib3.exceptions.NewConnectionError'>

urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7deb4c4df410>: Failed to establish a new connection: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7deb7381eb60>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7deb738bc040>
           └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7deb739e7560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7deb737d8910>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    └ <function subprocess_started at 0x7deb7290f560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7deb72865990>>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x7deb7290e5c0>
           │       │   └ <uvicorn.server.Server object at 0x7deb72865990>
           │       └ <function run at 0x7deb72cb94e0>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7deb728319c0>
           │      └ <function Runner.run at 0x7deb72c5f060>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7deb72852a80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4cfe...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4cfe...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4cfe...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
          └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7deb4c6af2e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4c4c8400>
                     │    │             └ <starlette.requests.Request object at 0x7deb4c4d4150>
                     │    └ <function log_requests at 0x7deb4ea022a0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>

  File "/app/app/main.py", line 56, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x7deb4c4d4150>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4c4c8400>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ MaxRetryError("HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Cau...
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c4c85e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c84a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c4c85e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c84a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c4c85e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c84a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4c8860>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c84a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4c8860>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c84a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0x7deb4e90a850>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4c8860>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c84a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │     └ <function Route.handle at 0x7deb716b7560>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4c8860>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c84a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0x7deb4e92f6a0>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7deb4c4d4510>
                     └ <function get_request_handler.<locals>.app at 0x7deb4e92f740>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7deb716b5b20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x7deb4c4d4890>, 'file_id': 158, 'request': <starlette.requests.Request...
                 │         └ <function get_file_open_url at 0x7deb4ea42840>
                 └ <fastapi.dependencies.models.Dependant object at 0x7deb4e94c510>

  File "/app/app/api/v1/endpoints/chat.py", line 375, in get_file_open_url
    url = mc.presigned_get_object(
          │  └ <function Minio.presigned_get_object at 0x7deb70293920>
          └ <minio.api.Minio object at 0x7deb56f5c750>

  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2138, in presigned_get_object
    return self.get_presigned_url(
           │    └ <function Minio.get_presigned_url at 0x7deb70293880>
           └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2076, in get_presigned_url
    region = self._get_region(bucket_name)
             │    │           └ 'knowledge-base'
             │    └ <function Minio._get_region at 0x7deb70291bc0>
             └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 470, in _get_region
    response = self._url_open(
               │    └ <function Minio._url_open at 0x7deb70291a80>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 279, in _url_open
    response = self._http.urlopen(
               │    │     └ <function PoolManager.urlopen at 0x7deb7042a700>
               │    └ <urllib3.poolmanager.PoolManager object at 0x7deb56f5dd50>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               │    │       │       │ │              └ {'body': None, 'headers': HTTPHeaderDict({'Host': 'localhost:9000', 'User-Agent': 'MinIO (Linux; x86_64) minio-py/7.2.0', 'x-...
               │    │       │       │ └ <property object at 0x7deb70556ca0>
               │    │       │       └ Url(scheme='http', auth=None, host='localhost', port=9000, path='/knowledge-base', query='location=', fragment=None)
               │    │       └ 'GET'
               │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x7deb704f0e00>
              └ Retry(total=0, connect=None, read=None, redirect=None, status=None)
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
          │             │      │    │            └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4df410>: Failed to establish a new connection: [Errn...
          │             │      │    └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4df410>: Failed to establish a new connection: [Errn...
          │             │      └ '/knowledge-base?location='
          │             └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4df410>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-29 06:29:12 | ERROR    | app.main:general_exception_handler:90 - Unexpected error: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4f7990>: Failed to establish a new connection: [Errno 111] Connection refused'))
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           │          └ <function create_connection at 0x7deb70509c60>
           └ <module 'urllib3.util.connection' from '/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py'>
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
          └ None
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
    │    │       └ ('127.0.0.1', 9000)
    │    └ <method 'connect' of '_socket.socket' objects>
    └ <socket.socket [closed] fd=-1, family=2, type=1, proto=6>

ConnectionRefusedError: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               │    └ <function HTTPConnectionPool._make_request at 0x7deb70428f40>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
    │    └ <function HTTPConnection.request at 0x7deb7042cd60>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4f7990>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 494, in request
    self.endheaders()
    │    └ <function HTTPConnection.endheaders at 0x7deb718e2a20>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4f7990>
  File "/usr/local/lib/python3.11/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    │    │            │                            └ False
    │    │            └ None
    │    └ <function HTTPConnection._send_output at 0x7deb718e25c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4f7990>
  File "/usr/local/lib/python3.11/http/client.py", line 1058, in _send_output
    self.send(msg)
    │    │    └ b'GET /knowledge-base?location= HTTP/1.1\r\nAccept-Encoding: identity\r\nHost: localhost:9000\r\nUser-Agent: MinIO (Linux; x8...
    │    └ <function HTTPConnection.send at 0x7deb718e23e0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4f7990>
  File "/usr/local/lib/python3.11/http/client.py", line 996, in send
    self.connect()
    │    └ <function HTTPConnection.connect at 0x7deb7042c7c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4f7990>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 325, in connect
    self.sock = self._new_conn()
    │    │      │    └ <function HTTPConnection._new_conn at 0x7deb7042c680>
    │    │      └ <urllib3.connection.HTTPConnection object at 0x7deb4c4f7990>
    │    └ None
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4f7990>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
          └ <class 'urllib3.exceptions.NewConnectionError'>

urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7deb4c4f7990>: Failed to establish a new connection: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7deb7381eb60>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7deb738bc040>
           └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7deb739e7560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7deb737d8910>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    └ <function subprocess_started at 0x7deb7290f560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7deb72865990>>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x7deb7290e5c0>
           │       │   └ <uvicorn.server.Server object at 0x7deb72865990>
           │       └ <function run at 0x7deb72cb94e0>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7deb728319c0>
           │      └ <function Runner.run at 0x7deb72c5f060>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7deb72852a80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4e47...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4e47...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4e47...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
          └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7deb4c4c8ae0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4c4c8a40>
                     │    │             └ <starlette.requests.Request object at 0x7deb4c4d5090>
                     │    └ <function log_requests at 0x7deb4ea022a0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>

  File "/app/app/main.py", line 56, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x7deb4c4d5090>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4c4c8a40>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ MaxRetryError("HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Cau...
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c4c8360>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c89a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c4c8360>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c89a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c4c8360>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c89a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c65f100>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c89a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c65f100>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c89a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0x7deb4e90a850>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c65f100>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c89a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │     └ <function Route.handle at 0x7deb716b7560>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c65f100>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c89a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0x7deb4e92f6a0>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7deb4c4e4ad0>
                     └ <function get_request_handler.<locals>.app at 0x7deb4e92f740>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7deb716b5b20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x7deb4c4d5850>, 'file_id': 159, 'request': <starlette.requests.Request...
                 │         └ <function get_file_open_url at 0x7deb4ea42840>
                 └ <fastapi.dependencies.models.Dependant object at 0x7deb4e94c510>

  File "/app/app/api/v1/endpoints/chat.py", line 375, in get_file_open_url
    url = mc.presigned_get_object(
          │  └ <function Minio.presigned_get_object at 0x7deb70293920>
          └ <minio.api.Minio object at 0x7deb56f5c750>

  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2138, in presigned_get_object
    return self.get_presigned_url(
           │    └ <function Minio.get_presigned_url at 0x7deb70293880>
           └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2076, in get_presigned_url
    region = self._get_region(bucket_name)
             │    │           └ 'knowledge-base'
             │    └ <function Minio._get_region at 0x7deb70291bc0>
             └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 470, in _get_region
    response = self._url_open(
               │    └ <function Minio._url_open at 0x7deb70291a80>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 279, in _url_open
    response = self._http.urlopen(
               │    │     └ <function PoolManager.urlopen at 0x7deb7042a700>
               │    └ <urllib3.poolmanager.PoolManager object at 0x7deb56f5dd50>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               │    │       │       │ │              └ {'body': None, 'headers': HTTPHeaderDict({'Host': 'localhost:9000', 'User-Agent': 'MinIO (Linux; x86_64) minio-py/7.2.0', 'x-...
               │    │       │       │ └ <property object at 0x7deb70556ca0>
               │    │       │       └ Url(scheme='http', auth=None, host='localhost', port=9000, path='/knowledge-base', query='location=', fragment=None)
               │    │       └ 'GET'
               │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x7deb704f0e00>
              └ Retry(total=0, connect=None, read=None, redirect=None, status=None)
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
          │             │      │    │            └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4f7990>: Failed to establish a new connection: [Errn...
          │             │      │    └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4f7990>: Failed to establish a new connection: [Errn...
          │             │      └ '/knowledge-base?location='
          │             └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4f7990>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-29 06:29:18 | ERROR    | app.main:general_exception_handler:90 - Unexpected error: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c507f50>: Failed to establish a new connection: [Errno 111] Connection refused'))
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           │          └ <function create_connection at 0x7deb70509c60>
           └ <module 'urllib3.util.connection' from '/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py'>
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
          └ None
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
    │    │       └ ('127.0.0.1', 9000)
    │    └ <method 'connect' of '_socket.socket' objects>
    └ <socket.socket [closed] fd=-1, family=2, type=1, proto=6>

ConnectionRefusedError: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               │    └ <function HTTPConnectionPool._make_request at 0x7deb70428f40>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
    │    └ <function HTTPConnection.request at 0x7deb7042cd60>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c507f50>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 494, in request
    self.endheaders()
    │    └ <function HTTPConnection.endheaders at 0x7deb718e2a20>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c507f50>
  File "/usr/local/lib/python3.11/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    │    │            │                            └ False
    │    │            └ None
    │    └ <function HTTPConnection._send_output at 0x7deb718e25c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c507f50>
  File "/usr/local/lib/python3.11/http/client.py", line 1058, in _send_output
    self.send(msg)
    │    │    └ b'GET /knowledge-base?location= HTTP/1.1\r\nAccept-Encoding: identity\r\nHost: localhost:9000\r\nUser-Agent: MinIO (Linux; x8...
    │    └ <function HTTPConnection.send at 0x7deb718e23e0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c507f50>
  File "/usr/local/lib/python3.11/http/client.py", line 996, in send
    self.connect()
    │    └ <function HTTPConnection.connect at 0x7deb7042c7c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c507f50>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 325, in connect
    self.sock = self._new_conn()
    │    │      │    └ <function HTTPConnection._new_conn at 0x7deb7042c680>
    │    │      └ <urllib3.connection.HTTPConnection object at 0x7deb4c507f50>
    │    └ None
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c507f50>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
          └ <class 'urllib3.exceptions.NewConnectionError'>

urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7deb4c507f50>: Failed to establish a new connection: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7deb7381eb60>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7deb738bc040>
           └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7deb739e7560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7deb737d8910>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    └ <function subprocess_started at 0x7deb7290f560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7deb72865990>>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x7deb7290e5c0>
           │       │   └ <uvicorn.server.Server object at 0x7deb72865990>
           │       └ <function run at 0x7deb72cb94e0>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7deb728319c0>
           │      └ <function Runner.run at 0x7deb72c5f060>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7deb72852a80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4fcc...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4fcc...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4fcc...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
          └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7deb4c4c87c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4c4c9bc0>
                     │    │             └ <starlette.requests.Request object at 0x7deb4c4fced0>
                     │    └ <function log_requests at 0x7deb4ea022a0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>

  File "/app/app/main.py", line 56, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x7deb4c4fced0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4c4c9bc0>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ MaxRetryError("HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Cau...
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c4c9da0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c9c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c4c9da0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c9c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c4c9da0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c9c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4ca020>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c9c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4ca020>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c9c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0x7deb4e90a850>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4ca020>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c9c60>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │     └ <function Route.handle at 0x7deb716b7560>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4ca020>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4c9c60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0x7deb4e92f6a0>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7deb4c4fd310>
                     └ <function get_request_handler.<locals>.app at 0x7deb4e92f740>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7deb716b5b20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x7deb4c4fd850>, 'file_id': 158, 'request': <starlette.requests.Request...
                 │         └ <function get_file_open_url at 0x7deb4ea42840>
                 └ <fastapi.dependencies.models.Dependant object at 0x7deb4e94c510>

  File "/app/app/api/v1/endpoints/chat.py", line 375, in get_file_open_url
    url = mc.presigned_get_object(
          │  └ <function Minio.presigned_get_object at 0x7deb70293920>
          └ <minio.api.Minio object at 0x7deb56f5c750>

  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2138, in presigned_get_object
    return self.get_presigned_url(
           │    └ <function Minio.get_presigned_url at 0x7deb70293880>
           └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2076, in get_presigned_url
    region = self._get_region(bucket_name)
             │    │           └ 'knowledge-base'
             │    └ <function Minio._get_region at 0x7deb70291bc0>
             └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 470, in _get_region
    response = self._url_open(
               │    └ <function Minio._url_open at 0x7deb70291a80>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 279, in _url_open
    response = self._http.urlopen(
               │    │     └ <function PoolManager.urlopen at 0x7deb7042a700>
               │    └ <urllib3.poolmanager.PoolManager object at 0x7deb56f5dd50>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               │    │       │       │ │              └ {'body': None, 'headers': HTTPHeaderDict({'Host': 'localhost:9000', 'User-Agent': 'MinIO (Linux; x86_64) minio-py/7.2.0', 'x-...
               │    │       │       │ └ <property object at 0x7deb70556ca0>
               │    │       │       └ Url(scheme='http', auth=None, host='localhost', port=9000, path='/knowledge-base', query='location=', fragment=None)
               │    │       └ 'GET'
               │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x7deb704f0e00>
              └ Retry(total=0, connect=None, read=None, redirect=None, status=None)
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
          │             │      │    │            └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c507f50>: Failed to establish a new connection: [Errn...
          │             │      │    └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c507f50>: Failed to establish a new connection: [Errn...
          │             │      └ '/knowledge-base?location='
          │             └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c507f50>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-29 06:29:24 | ERROR    | app.main:general_exception_handler:90 - Unexpected error: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c52bed0>: Failed to establish a new connection: [Errno 111] Connection refused'))
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           │          └ <function create_connection at 0x7deb70509c60>
           └ <module 'urllib3.util.connection' from '/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py'>
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
          └ None
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
    │    │       └ ('127.0.0.1', 9000)
    │    └ <method 'connect' of '_socket.socket' objects>
    └ <socket.socket [closed] fd=-1, family=2, type=1, proto=6>

ConnectionRefusedError: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               │    └ <function HTTPConnectionPool._make_request at 0x7deb70428f40>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
    │    └ <function HTTPConnection.request at 0x7deb7042cd60>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c52bed0>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 494, in request
    self.endheaders()
    │    └ <function HTTPConnection.endheaders at 0x7deb718e2a20>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c52bed0>
  File "/usr/local/lib/python3.11/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    │    │            │                            └ False
    │    │            └ None
    │    └ <function HTTPConnection._send_output at 0x7deb718e25c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c52bed0>
  File "/usr/local/lib/python3.11/http/client.py", line 1058, in _send_output
    self.send(msg)
    │    │    └ b'GET /knowledge-base?location= HTTP/1.1\r\nAccept-Encoding: identity\r\nHost: localhost:9000\r\nUser-Agent: MinIO (Linux; x8...
    │    └ <function HTTPConnection.send at 0x7deb718e23e0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c52bed0>
  File "/usr/local/lib/python3.11/http/client.py", line 996, in send
    self.connect()
    │    └ <function HTTPConnection.connect at 0x7deb7042c7c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c52bed0>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 325, in connect
    self.sock = self._new_conn()
    │    │      │    └ <function HTTPConnection._new_conn at 0x7deb7042c680>
    │    │      └ <urllib3.connection.HTTPConnection object at 0x7deb4c52bed0>
    │    └ None
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c52bed0>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
          └ <class 'urllib3.exceptions.NewConnectionError'>

urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7deb4c52bed0>: Failed to establish a new connection: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7deb7381eb60>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7deb738bc040>
           └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7deb739e7560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7deb737d8910>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    └ <function subprocess_started at 0x7deb7290f560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7deb72865990>>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x7deb7290e5c0>
           │       │   └ <uvicorn.server.Server object at 0x7deb72865990>
           │       └ <function run at 0x7deb72cb94e0>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7deb728319c0>
           │      └ <function Runner.run at 0x7deb72c5f060>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7deb72852a80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c515b...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c5...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c515b...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c5...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c515b...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c5...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
          └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7deb4c4c9f80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4c4ca660>
                     │    │             └ <starlette.requests.Request object at 0x7deb4c515d50>
                     │    └ <function log_requests at 0x7deb4ea022a0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>

  File "/app/app/main.py", line 56, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x7deb4c515d50>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4c4ca660>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ MaxRetryError("HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Cau...
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c4ca2a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4ca340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c4ca2a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4ca340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c4ca2a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4ca340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4ca480>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4ca340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4ca480>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4ca340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0x7deb4e90a850>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4ca480>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4ca340>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │     └ <function Route.handle at 0x7deb716b7560>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4ca480>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4ca340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0x7deb4e92f6a0>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7deb4c516110>
                     └ <function get_request_handler.<locals>.app at 0x7deb4e92f740>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7deb716b5b20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x7deb4c516310>, 'file_id': 158, 'request': <starlette.requests.Request...
                 │         └ <function get_file_open_url at 0x7deb4ea42840>
                 └ <fastapi.dependencies.models.Dependant object at 0x7deb4e94c510>

  File "/app/app/api/v1/endpoints/chat.py", line 375, in get_file_open_url
    url = mc.presigned_get_object(
          │  └ <function Minio.presigned_get_object at 0x7deb70293920>
          └ <minio.api.Minio object at 0x7deb56f5c750>

  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2138, in presigned_get_object
    return self.get_presigned_url(
           │    └ <function Minio.get_presigned_url at 0x7deb70293880>
           └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2076, in get_presigned_url
    region = self._get_region(bucket_name)
             │    │           └ 'knowledge-base'
             │    └ <function Minio._get_region at 0x7deb70291bc0>
             └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 470, in _get_region
    response = self._url_open(
               │    └ <function Minio._url_open at 0x7deb70291a80>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 279, in _url_open
    response = self._http.urlopen(
               │    │     └ <function PoolManager.urlopen at 0x7deb7042a700>
               │    └ <urllib3.poolmanager.PoolManager object at 0x7deb56f5dd50>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               │    │       │       │ │              └ {'body': None, 'headers': HTTPHeaderDict({'Host': 'localhost:9000', 'User-Agent': 'MinIO (Linux; x86_64) minio-py/7.2.0', 'x-...
               │    │       │       │ └ <property object at 0x7deb70556ca0>
               │    │       │       └ Url(scheme='http', auth=None, host='localhost', port=9000, path='/knowledge-base', query='location=', fragment=None)
               │    │       └ 'GET'
               │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x7deb704f0e00>
              └ Retry(total=0, connect=None, read=None, redirect=None, status=None)
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
          │             │      │    │            └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c52bed0>: Failed to establish a new connection: [Errn...
          │             │      │    └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c52bed0>: Failed to establish a new connection: [Errn...
          │             │      └ '/knowledge-base?location='
          │             └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c52bed0>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-29 06:29:30 | ERROR    | app.main:general_exception_handler:90 - Unexpected error: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4f4090>: Failed to establish a new connection: [Errno 111] Connection refused'))
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           │          └ <function create_connection at 0x7deb70509c60>
           └ <module 'urllib3.util.connection' from '/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py'>
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
          └ None
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
    │    │       └ ('127.0.0.1', 9000)
    │    └ <method 'connect' of '_socket.socket' objects>
    └ <socket.socket [closed] fd=-1, family=2, type=1, proto=6>

ConnectionRefusedError: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               │    └ <function HTTPConnectionPool._make_request at 0x7deb70428f40>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
    │    └ <function HTTPConnection.request at 0x7deb7042cd60>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4f4090>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 494, in request
    self.endheaders()
    │    └ <function HTTPConnection.endheaders at 0x7deb718e2a20>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4f4090>
  File "/usr/local/lib/python3.11/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
    │    │            │                            └ False
    │    │            └ None
    │    └ <function HTTPConnection._send_output at 0x7deb718e25c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4f4090>
  File "/usr/local/lib/python3.11/http/client.py", line 1058, in _send_output
    self.send(msg)
    │    │    └ b'GET /knowledge-base?location= HTTP/1.1\r\nAccept-Encoding: identity\r\nHost: localhost:9000\r\nUser-Agent: MinIO (Linux; x8...
    │    └ <function HTTPConnection.send at 0x7deb718e23e0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4f4090>
  File "/usr/local/lib/python3.11/http/client.py", line 996, in send
    self.connect()
    │    └ <function HTTPConnection.connect at 0x7deb7042c7c0>
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4f4090>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 325, in connect
    self.sock = self._new_conn()
    │    │      │    └ <function HTTPConnection._new_conn at 0x7deb7042c680>
    │    │      └ <urllib3.connection.HTTPConnection object at 0x7deb4c4f4090>
    │    └ None
    └ <urllib3.connection.HTTPConnection object at 0x7deb4c4f4090>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
          └ <class 'urllib3.exceptions.NewConnectionError'>

urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7deb4c4f4090>: Failed to establish a new connection: [Errno 111] Connection refused


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7deb7381eb60>
  File "/usr/local/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7deb738bc040>
           └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7deb739e7560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7deb737d8910>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
    │    └ <function subprocess_started at 0x7deb7290f560>
    └ <SpawnProcess name='SpawnProcess-1' parent=1 started>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7deb72865990>>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x7deb7290e5c0>
           │       │   └ <uvicorn.server.Server object at 0x7deb72865990>
           │       └ <function run at 0x7deb72cb94e0>
           └ <module 'asyncio' from '/usr/local/lib/python3.11/asyncio/__init__.py'>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7deb728319c0>
           │      └ <function Runner.run at 0x7deb72c5f060>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /usr/local/lib/python3.11/site-packages/uvicorn/server.py:81> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7deb72852a80>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7deb72865210>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c5352...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c5...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7deb728b24d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c5352...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c5...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c5352...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c5...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
          └ <fastapi.applications.FastAPI object at 0x7deb4e90a790>
> File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7deb4c4cac00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7deb4c5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7deb4e94d750>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4c4ca840>
                     │    │             └ <starlette.requests.Request object at 0x7deb4c516410>
                     │    └ <function log_requests at 0x7deb4ea022a0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>

  File "/app/app/main.py", line 56, in log_requests
    response = await call_next(request)
                     │         └ <starlette.requests.Request object at 0x7deb4c516410>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x7deb4c4ca840>

  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          └ MaxRetryError("HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Cau...
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c4cb100>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4ca700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7deb54adb0d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/trustedhost.py", line 34, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c4cb100>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4ca700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
          └ <starlette.middleware.trustedhost.TrustedHostMiddleware object at 0x7deb54abfe50>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7deb4c4cb100>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4ca700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7deb4f3fd2d0>
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4cb4c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4ca700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7deb4eaf83d0>
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4cb4c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4ca700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <fastapi.routing.APIRouter object at 0x7deb4e90a850>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7deb4eaf8110>
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4cb4c0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4ca700>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │     └ <function Route.handle at 0x7deb716b7560>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7deb4c4cb4c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7deb4c4ca700>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.19.0.6', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0x7deb4e92f6a0>
          └ APIRoute(path='/api/v1/chat/files/{file_id}/open-url', name='get_file_open_url', methods=['GET'])
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7deb4c535690>
                     └ <function get_request_handler.<locals>.app at 0x7deb4e92f740>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7deb716b5b20>
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x7deb4c535910>, 'file_id': 158, 'request': <starlette.requests.Request...
                 │         └ <function get_file_open_url at 0x7deb4ea42840>
                 └ <fastapi.dependencies.models.Dependant object at 0x7deb4e94c510>

  File "/app/app/api/v1/endpoints/chat.py", line 375, in get_file_open_url
    url = mc.presigned_get_object(
          │  └ <function Minio.presigned_get_object at 0x7deb70293920>
          └ <minio.api.Minio object at 0x7deb56f5c750>

  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2138, in presigned_get_object
    return self.get_presigned_url(
           │    └ <function Minio.get_presigned_url at 0x7deb70293880>
           └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 2076, in get_presigned_url
    region = self._get_region(bucket_name)
             │    │           └ 'knowledge-base'
             │    └ <function Minio._get_region at 0x7deb70291bc0>
             └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 470, in _get_region
    response = self._url_open(
               │    └ <function Minio._url_open at 0x7deb70291a80>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/minio/api.py", line 279, in _url_open
    response = self._http.urlopen(
               │    │     └ <function PoolManager.urlopen at 0x7deb7042a700>
               │    └ <urllib3.poolmanager.PoolManager object at 0x7deb56f5dd50>
               └ <minio.api.Minio object at 0x7deb56f5c750>
  File "/usr/local/lib/python3.11/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               │    │       │       │ │              └ {'body': None, 'headers': HTTPHeaderDict({'Host': 'localhost:9000', 'User-Agent': 'MinIO (Linux; x86_64) minio-py/7.2.0', 'x-...
               │    │       │       │ └ <property object at 0x7deb70556ca0>
               │    │       │       └ Url(scheme='http', auth=None, host='localhost', port=9000, path='/knowledge-base', query='location=', fragment=None)
               │    │       └ 'GET'
               │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
               └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x7deb70429120>
           └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.11/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x7deb704f0e00>
              └ Retry(total=0, connect=None, read=None, redirect=None, status=None)
  File "/usr/local/lib/python3.11/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
          │             │      │    │            └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4f4090>: Failed to establish a new connection: [Errn...
          │             │      │    └ NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4f4090>: Failed to establish a new connection: [Errn...
          │             │      └ '/knowledge-base?location='
          │             └ <urllib3.connectionpool.HTTPConnectionPool object at 0x7deb4c693e10>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=9000): Max retries exceeded with url: /knowledge-base?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7deb4c4f4090>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-29 07:56:35 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 400 - 不支持的文件类型
2025-09-29 07:58:30 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 400 - 不支持的文件类型
2025-09-29 08:00:02 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 400 - 不支持的文件类型
2025-09-29 08:37:14 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 404 - Not Found
2025-09-29 08:59:35 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 404 - Conversation not found
2025-09-30 00:54:36 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 404 - Not Found
2025-09-30 01:06:53 | ERROR    | app.services.bailian_client:create_embeddings:161 - HTTP error on segments batch (0-10): 400 - {"error":{"code":"InvalidParameter","param":null,"message":"Inference error: Range of input length should be [1, 2048]","type":"InvalidParameter"},"id":"ee8b4995-ef07-4c33-8f31-0e06ae503050","request_id":"ee8b4995-ef07-4c33-8f31-0e06ae503050"}
2025-09-30 01:06:54 | ERROR    | app.services.bailian_client:create_embeddings:168 - embedding failed on single segment: Client error '400 Bad Request' for url 'https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-09-30 01:06:54 | ERROR    | app.services.bailian_client:create_embeddings:168 - embedding failed on single segment: Client error '400 Bad Request' for url 'https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-09-30 01:06:55 | ERROR    | app.services.bailian_client:create_embeddings:168 - embedding failed on single segment: Client error '400 Bad Request' for url 'https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-09-30 01:06:55 | ERROR    | app.services.bailian_client:create_embeddings:168 - embedding failed on single segment: Client error '400 Bad Request' for url 'https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-09-30 01:06:56 | ERROR    | app.services.bailian_client:create_embeddings:168 - embedding failed on single segment: Client error '400 Bad Request' for url 'https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-09-30 01:06:57 | ERROR    | app.services.bailian_client:create_embeddings:168 - embedding failed on single segment: Client error '400 Bad Request' for url 'https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-09-30 01:06:57 | ERROR    | app.services.bailian_client:create_embeddings:168 - embedding failed on single segment: Client error '400 Bad Request' for url 'https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-09-30 01:06:57 | ERROR    | app.services.bailian_client:create_embeddings:168 - embedding failed on single segment: Client error '400 Bad Request' for url 'https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-09-30 01:06:58 | ERROR    | app.services.bailian_client:create_embeddings:168 - embedding failed on single segment: Client error '400 Bad Request' for url 'https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-09-30 01:06:59 | ERROR    | app.services.bailian_client:create_embeddings:168 - embedding failed on single segment: Client error '400 Bad Request' for url 'https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-09-30 01:06:59 | ERROR    | app.services.bailian_client:create_embeddings:161 - HTTP error on segments batch (0-1): 400 - {"error":{"code":"InvalidParameter","param":null,"message":"Inference error: Range of input length should be [1, 2048]","type":"InvalidParameter"},"id":"80618720-363e-452a-a61e-110b3d1a3137","request_id":"80618720-363e-452a-a61e-110b3d1a3137"}
2025-09-30 01:06:59 | ERROR    | app.services.bailian_client:create_embeddings:168 - embedding failed on single segment: Client error '400 Bad Request' for url 'https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2025-09-30 01:24:21 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 404 - Conversation not found
2025-09-30 01:24:23 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 404 - Conversation not found
2025-09-30 01:24:23 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 404 - Conversation not found
2025-09-30 01:24:24 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 404 - Conversation not found
2025-09-30 01:24:24 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 404 - Conversation not found
2025-09-30 01:24:24 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 404 - Conversation not found
2025-09-30 01:24:25 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 404 - Conversation not found
2025-09-30 01:24:30 | ERROR    | app.main:http_exception_handler:74 - HTTP error: 404 - Conversation not found
